<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Nav-Nirman SAARTHI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar { background-color: #ffffff; }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .dark .sidebar, .dark .card {
            background-color: #1c1b1a;
            border: 1px solid #374151;
            box-shadow: none;
        }
        .dark .card:hover {
            background-color: #2c2b2a;
        }
        #map-container { position: relative; }
        .state {
            stroke: #ffffff;
            stroke-width: 0.7;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            cursor: pointer;
        }
        .dark .state { stroke: #1c1b1a; }
        .state:hover { opacity: 0.8; transform: translateY(-1px); }
        .high-utilization { fill: #16a34a; }
        .medium-utilization { fill: #f59e0b; }
        .low-utilization { fill: #dc2626; }
        .no-data { fill: #d1d5db; }
        .dark .no-data { fill: #4b5563; }
        #tooltip {
            position: absolute; display: none; background-color: rgba(17, 24, 39, 0.9);
            color: white; padding: 0.5rem 0.75rem; border-radius: 0.375rem;
            font-size: 0.875rem; pointer-events: none; white-space: nowrap;
            z-index: 10; transition: opacity 0.2s;
        }
        .modal-body::-webkit-scrollbar { width: 8px; }
        .modal-body::-webkit-scrollbar-track { background: #f1f5f9; }
        .dark .modal-body::-webkit-scrollbar-track { background: #374151; }
        .modal-body::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark .modal-body::-webkit-scrollbar-thumb { background: #4b5563; }
        .modal-body::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark .modal-body::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        select:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body class="flex min-h-screen bg-[#fdfaf6] dark:bg-black">
    <aside class="sidebar w-64 flex-shrink-0 border-r border-slate-200 dark:border-gray-700 flex flex-col">
        <div class="p-6">
            <h1 class="text-2xl font-bold text-slate-800 dark:text-gray-100 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2 text-indigo-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.874 6 7.5 6h5c.626 0 .988-.27 1.256-.579A6.012 6.012 0 0115.668 8.027c.21.34.332.732.332 1.155a3.999 3.999 0 01-4 4c-1.933 0-3.5-1.567-3.5-3.5a3.999 3.999 0 011.006-2.622c.23-.352.484-.65.744-.897C10.5 6.27 10.246 6 10 6h-.5a.5.5 0 00-.5.5v1.5a.5.5 0 00.5.5h.5a.5.5 0 00.5-.5v-1a.5.5 0 00-.5-.5h-2a.5.5 0 00-.5.5v1a.5.5 0 00.5.5h.5a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5h-2a.5.5 0 00-.5.5v1.5a.5.5 0 00.5.5H8a.5.5 0 00.5-.5V9.5a3.5 3.5 0 00-3.5-3.5c-.538 0-1.03.123-1.468.342z" clip-rule="evenodd" /></svg>
                Nav-Nirman
            </h1>
        </div>
        <nav class="flex-1 px-4 py-2">
            <a href="#" id="nav-dashboard" class="flex items-center px-4 py-2.5 text-slate-700 bg-indigo-50 dark:bg-white dark:text-slate-900 rounded-lg font-semibold"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 text-indigo-600"></i>Dashboard</a>
            <a href="#" id="nav-projects" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="clipboard-list" class="w-5 h-5 mr-3"></i>Projects</a>
            <a href="#" id="nav-state-performance" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="bar-chart-2" class="w-5 h-5 mr-3"></i>State Performance</a>
            <a href="#" id="nav-fund-management" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="landmark" class="w-5 h-5 mr-3"></i>Fund Management</a>
            <a href="./fundflow.html" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="arrow-right-left" class="w-5 h-5 mr-3"></i>Fund Flow</a>
            <a href="#" id="nav-policy-analytics" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="brain-circuit" class="w-5 h-5 mr-3"></i>Policy Analytics</a>
            <a href="#" id="nav-approvals" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="check-square" class="w-5 h-5 mr-3"></i>Approvals</a>
            <a href="#" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="settings" class="w-5 h-5 mr-3"></i>Settings</a>
        </nav>

        <div class="px-4 py-4 border-t border-slate-200 dark:border-gray-700">
            <div class="p-4 rounded-lg bg-slate-100 dark:bg-gray-800/50 text-center">
                <p class="text-sm font-medium text-slate-800 dark:text-gray-200 mb-3">Need help with the portal?</p>
                <button class="w-full bg-indigo-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700">Contact Support</button>
            </div>
            <a href="./login.html" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-2 font-medium">
                <i data-lucide="log-out" class="w-5 h-5 mr-3"></i>
                Sign Out
            </a>
        </div>
    </aside>

    <main class="flex-1 p-6 lg:p-8 overflow-y-auto">
        
        <div id="national-dashboard-view">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">National Dashboard</h2>
                    <p class="text-slate-500 dark:text-gray-400 mt-1">Nation-wide performance and fund flow overview</p>
                </div>
                <div class="flex items-center mt-4 sm:mt-0">
                     <div class="flex items-center space-x-4">
                          <button class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700 relative"><i data-lucide="bell" class="w-5 h-5 text-slate-600 dark:text-gray-400"></i><span class="absolute top-1 right-1.5 h-2 w-2 rounded-full bg-red-500"></span></button>
                          <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700"><i data-lucide="sun" id="theme-toggle-light-icon" class="w-5 h-5 text-slate-600 dark:text-gray-400"></i><i data-lucide="moon" id="theme-toggle-dark-icon" class="w-5 h-5 text-slate-600 dark:text-gray-400 hidden"></i></button>
                     </div>
                     <div class="flex items-center ml-6">
                          <img src="https://placehold.co/40x40/E2E8F0/475569?text=AS" alt="Ministry Secretary" class="w-10 h-10 rounded-full">
                          <div class="ml-3"><p class="font-semibold text-slate-800 dark:text-gray-100">Dr. Anjali Sharma</p><p class="text-sm text-slate-500 dark:text-gray-400">Secretary, MoSJE</p></div>
                     </div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Total Funds Disbursed</h3><div class="p-2 bg-blue-100 dark:bg-blue-500/10 rounded-md"><i data-lucide="indian-rupee" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹1.25 Lakh Cr</p><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">FY 2025-26 Target: ₹2 Lakh Cr</p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Overall Fund Utilization</h3><div class="p-2 bg-green-100 dark:bg-green-500/10 rounded-md"><i data-lucide="pie-chart" class="w-5 h-5 text-green-600 dark:text-green-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">62.5%</p><p class="text-sm text-green-600 flex items-center mt-1"><i data-lucide="arrow-up" class="w-4 h-4 mr-1"></i><span>2.1%</span> <span class="text-slate-500 dark:text-gray-400 ml-1">vs last quarter</span></p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">UCs Pending (Value)</h3><div class="p-2 bg-amber-100 dark:bg-amber-500/10 rounded-md"><i data-lucide="file-clock" class="w-5 h-5 text-amber-600 dark:text-amber-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹5.1 Lakh Cr</p><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Across 15,230 projects</p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">High-Risk Projects (AI)</h3><div class="p-2 bg-red-100 dark:bg-red-500/10 rounded-md"><i data-lucide="shield-alert" class="w-5 h-5 text-red-600 dark:text-red-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">842</p><p class="text-sm text-red-600 flex items-center mt-1"><i data-lucide="trending-up" class="w-4 h-4 mr-1"></i><span>12 new</span> <span class="text-slate-500 dark:text-gray-400 ml-1"> flagged today</span></p></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                <div class="card lg:col-span-2 p-5" id="map-container">
                     <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-2">National Fund Utilization Heatmap</h3>
                     <div id="tooltip"></div>
                     <svg id="india-map-svg" viewBox="0 0 570 630" xmlns="http://www.w3.org/2000/svg">
                          <path id="IN-AP" class="state" data-name="Andhra Pradesh" d="m216,423l-3,11l-12,1l-4,11l-10,3l1-13l-10-3l-10,14l-4,1l-15-2l2-16l-5-1l-3,6l-8-6l-3-11l3-10l-3-8l11-13l21-1l2,4l10,1l2-7l12-1l7,9l5,2l6,11z"/>
                          <path id="IN-AR" class="state" data-name="Arunachal Pradesh" d="m507,173l-12-5l-14-17l-18-4l-10-1l-11,13l-1,7l-13-1l-2,6l-13,6l-11-2l-10,1l-3,11l20,18l1,9l11,8l13-13l10-1l12,11l21,5l2,14l12,1l-1-12l4-2l1-6l7-13l-4-15z"/>
                          <path id="IN-AS" class="state" data-name="Assam" d="m496,211l-20-18l-1-9l-11-8l-13,13l-10,1l-12-11l-21-5l-2-14l-12-1l1-6l-7,2l-9-15l-11-1l-1,9l-11,10l-2,8l-12-1l-1,6l-8-2l-15,1l-4,7l-1,9l9,13l6,1l3-6l18-4l6,5l22-3l11,12l8-2l6-4l3-9l5-1l9,6z"/>
                          <path id="IN-BR" class="state" data-name="Bihar" d="m362,231l-10-17l-15-2l-12-1l-17,4l-11,21l-13-2l-13,9l-11-2l-1,8l-6-2l-2,11l4,6l10-2l6,10l12,1l23-10l1,11l15,3l11,16l9-1l6-11l4-1l-1-15l-4-9l11-1l8-4l1,8h11l-2-13z"/>
                          <path id="IN-CT" class="state" data-name="Chhattisgarh" d="m278,348l-9-10l-2-12l-14-6l-3,9l-11,1l-12,21l-9,1l-11-14l-23,1l-6,11l2,8l13,6l2,6l-3,10l20,7l10-1l1,5l13,3l11,11l13-1l-2-10l10,3l11-12l2-14l-14-12z"/>
                          <path id="IN-GA" class="state" data-name="Goa" d="m112,448l-5-1l-2,5l3,2l4-6z"/>
                          <path id="IN-GJ" class="state" data-name="Gujarat" d="M37,285l-4-15l-4-1l-11-22l-1-12l-4-1l-1-10l22-1l2,3l12,1l4-6l-1-13l-15-2l-1,4l-12,2l-3-9l-10-1l-3,5l-8,3l1,8l4,1l-2,12l-11,2l-1-4l-12-2l-1,6l5,1l-2,5l10-1l1,14l-3-1l-1,5l13,1l-2-6l4-1l-1,14l7,1l3-4l-3-12l7-2l11,1l15-13l18-12l10,13l6-1l7,11l-3,14l-14,14l-1,8l-12,2l-17-15l-10,2z"/>
                          <path id="IN-HR" class="state" data-name="Haryana" d="m142,165l-10,13l-7,2l-12,15l-10,2l-1,5l10,11l12,1l14-12l16-2l-1-9l4-8l2-4l-3-1l-1,3l-9,1l-7-10z"/>
                          <path id="IN-HP" class="state" data-name="Himachal Pradesh" d="m173,129l-11,1l-12,12l-4,10l-14,7l-2,8l10,13l7-2l10-10l11,1l1-11l5-1l3-7l-4-10l-3-6z"/>
                          <path id="IN-JH" class="state" data-name="Jharkhand" d="m343,284l-23-10l-12-1l-6-10l-10,2l-4-6l-6,6l-8,17l-13,6l-2,12l9,10l14,6l-2-9l14,12l16,2l10-1l12-11l-6-13z"/>
                          <path id="IN-JK" class="state" data-name="Jammu and Kashmir" d="m109,69l-3-7l-12-3l-1,8l-10,1l-2,7l-15,1l-3-6l-14,1l-2,10l-13,1l-2,6l6,11l-2,11l7,2l4-7l11,1l2,6l10,3l9-2l2-11l12,1l12-12l11-1l2-11l-1-9l13-9l-3-9l-11-2l-9,11z"/>
                          <path id="IN-KA" class="state" data-name="Karnataka" d="m146,478l-3-14l-9-1l-10-12l-12-1l-2-5l-5,1l-4,6l-3-2l2-5l-3-2l-4,6h-5l-2-12l-7-2l-3,6l-8-6l-3-11l3-10l-3-8l11-13l21-1l-2,7l13,10l10-2l6,6l1,12l12-1l10-14l10,3l-1,13l10,3l4-11l12-1l3-11l-11,2l-2-8l12-8l15,1l-1,8l7,3l-2,14l-11,12l-8,24z"/>
                          <path id="IN-KL" class="state" data-name="Kerala" d="m144,534l-3-10l-10-4l-1-12l-11-5l-2-12l-3-1l-1-10l-4-2l-3,10l-12,30l-1,9l11,8l11,3l12-12l1,10l12-1l3-7z"/>
                          <path id="IN-MP" class="state" data-name="Madhya Pradesh" d="m244,248l-15-13l-18-12l-10,13l-6-1l-7,11l-3,14l-14,14l-1,8l-12,2l-17-15l-10,2l-1-7l-8-3l-7,2l-11-1l-12,12l-2,11l-13,6l-3,7l1,8l11,14l9-1l12-21l11-1l3-9l14,6l2,12l9,10l-2,14l11-2l12,8l-2,10l13-1l11-11l13-3l1-5l10,1l20-7l-3-10l2-6l13-6l2-8l-6-11l-23-1l-11,14z"/>
                          <path id="IN-MH" class="state" data-name="Maharashtra" d="m191,399l-2-16l-5-1l-3,6l-8-6l-7-2l-11-1l-12-12l-2-11l-13-6l-3,7l-1,8l-11-14l-9,1l-1,7l-8,3l-7-2l-11,1l-12-12l-2-11l-11,2l-7,2l-1-8l-14-14l-3-14l7-11l10-1l11,14l15,1l2-8l23,1l6-11l-2-8l23,1l11,14l-9,1l12,21l11-1l3-9l14,6l2,12l9,10l-2,14l11-2l12,8l-1,8l-15-1l-12,8l-3,10z"/>
                          <path id="IN-MN" class="state" data-name="Manipur" d="m510,265l-9-13l-6-1l-3,6l-18-4l-6,5l-1,10l12,13l1,10l9,5l13,2l-2-16l2-14z"/>
                          <path id="IN-ML" class="state" data-name="Meghalaya" d="m443,251l-15,1l-4,7l-1,9l9,13l6,1l3-6l18-4l6,5l-11-22z"/>
                          <path id="IN-MZ" class="state" data-name="Mizoram" d="m484,286l-1-10l-12-13l-1-10l-9-5l-1,12l-12,12l-1,16l14,14l12-2l10-11l-3-13z"/>
                          <path id="IN-NL" class="state" data-name="Nagaland" d="m522,232l-22-3l-11,12l-8-2l-6-4l-3-9l5-1l9,6l1,10l12-13l1,10l9,5l13,2l-2-13z"/>
                          <path id="IN-OR" class="state" data-name="Odisha" d="m327,370l-16-2l-14-12l-2,9l-6-13l-12-11l-10,1l-12,11l-13,1l2,10l-10-3l-11,12l-2,14l14,12l-9,10l-2,8l11,8l11-2l11,2l10-1l11-11l1,10l13-2l2-11l11,2l10-10l2-10z"/>
                          <path id="IN-PB" class="state" data-name="Punjab" d="m123,124l-2,10l-13,1l-2,6l6,11l-2,11l7,2l4-7l11,1l2,6l10,3l9-2l-2-12l-12-15l-10-2l-1-5l10-11z"/>
                          <path id="IN-RJ" class="state" data-name="Rajasthan" d="M129,298l-17-15l-10,2l-1-7l-8-3l-7,2l-11-1l-12-12l-2-11l-11-2l-7-2l-1-8l-14-14l-3-14l7-11l10-1l11,14l15,1l2-8l10-1l12,12l10,1l1,9l7-2l12-1l14-12l16-2l-1-9l4-8l2-4l-3-1l-1,3l-9,1l-7-10l1,5l10,2l12,15l7-2l10-13l15,13l18,12z"/>
                          <path id="IN-SK" class="state" data-name="Sikkim" d="m403,195l-11-16l-15-3l-1-11l11-8l12,7l2,13l2,10z"/>
                          <path id="IN-TN" class="state" data-name="Tamil Nadu" d="m197,515l-11-12l-8,24l-11,2l-3-6l-7-3l-2,14l-11,12l-8,24l-12-30l-3-10l4,2l1,10l3,1l2,12l11,5l1,12l10,4l3,10l-3,11l12,9l12,1l1,10l11-2l10,2l7-11l2-12l-2-10l11-13z"/>
                          <path id="IN-TR" class="state" data-name="Tripura" d="m471,288l-14-14l-1,16l-12,12l-1,16l20-1l11-8l-3-21z"/>
                          <path id="IN-TG" class="state" data-name="Telangana" d="M194,394l-10,-14l-10,3l-1,13l10,3l-2,7l13,10l10,-2l6,-6l1,-12l12,-1l-7,-9l-12,1z"/>
                          <path id="IN-UA" class="state" data-name="Uttarakhand" d="m194,158l-11-1l-1-11l-5-1l-3-7l4,10l3,6l-13,11l-10-13l-7,2l-10-10l-11,1l1,11l15,2l14,12l2,4l3,1l-2-3l9-1l7,10l-1-5l10-11z"/>
                          <path id="IN-UP" class="state" data-name="Uttar Pradesh" d="m278,211l-1-5l-10,1l-20,7l-3-10l2-6l-13,6l-2,8l-6,11l-23,1l-11,14l-1-8l-11,2l-13-9l-13,2l-11-21l-17-4l-12,1l-15,2l-10,17l-1,8l2-11l6,2l-1-8l11,2l-4,6l-10-11l12,1l14-12l2,4l3,1l-2-3l9-1l7,10l-1-5l10-11l-10-13l-7,2l-10,10l10,11l-12-1l-10-11l1,5l-10-2l-12-15l-7,2l-10,13l15,13l18,12z"/>
                          <path id="IN-WB" class="state" data-name="West Bengal" d="m392,308l-6-13l-12,11l-10,1l-16-2l-14-12l-2-9l13-6l-8-17l-6-6l4-6l2,11l6,2l1,8l11-2l-1-8l8,4l11,1l4,9l1,15l-4,1l-6,11l-9,1l-1-9l11-8l12,7l2,13l2,10l11-8l-2-13l-11-7l1,11l15-3l-1,11l-11,11l2,10l11,2l10-1l-11-8l3-8l12-1z"/>
                     </svg>
                     <div class="flex flex-wrap justify-center gap-x-4 gap-y-2 mt-2 text-xs text-slate-600 dark:text-gray-300">
                          <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-600 mr-2"></span> &gt; 90% (High)</div>
                          <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-amber-500 mr-2"></span> 60-90% (Medium)</div>
                          <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-600 mr-2"></span> &lt; 60% (Low)</div>
                          <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600 mr-2"></span> No Data</div>
                     </div>
                </div>
                <div class="card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100">State Performance Ranking</h3>
                        <a href="#" class="text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:underline">View All</a>
                    </div>
                    <div>
                        <table class="w-full text-left text-sm">
                             <thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800">
                                  <tr>
                                       <th class="w-3/4 px-4 py-3">State</th>
                                       <th class="w-1/4 px-4 py-3 text-right">Utilization %</th>
                                  </tr>
                             </thead>
                             <tbody class="dark:text-gray-300 divide-y dark:divide-gray-700">
                                  <tr class="font-medium"><td class="px-4 py-3">1. Gujarat</td><td class="px-4 py-3 text-right text-green-600 dark:text-green-400">94.2%</td></tr>
                                  <tr><td class="px-4 py-3">2. Tamil Nadu</td><td class="px-4 py-3 text-right text-green-600 dark:text-green-400">93.5%</td></tr>
                                  <tr><td class="px-4 py-3">3. Kerala</td><td class="px-4 py-3 text-right text-green-600 dark:text-green-400">92.1%</td></tr>
                                  <tr><td class="px-4 py-3">4. Maharashtra</td><td class="px-4 py-3 text-right text-green-600 dark:text-green-400">91.8%</td></tr>
                                  <tr><td colspan="2" class="py-1 text-center text-slate-400">...</td></tr>
                                  <tr><td class="px-4 py-3">26. West Bengal</td><td class="px-4 py-3 text-right text-red-600 dark:text-red-400">45.1%</td></tr>
                                  <tr><td class="px-4 py-3">27. Bihar</td><td class="px-4 py-3 text-right text-red-600 dark:text-red-400">42.7%</td></tr>
                                  <tr><td class="px-4 py-3">28. Jharkhand</td><td class="px-4 py-3 text-right text-red-600 dark:text-red-400">38.9%</td></tr>
                             </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
                <div class="card p-5"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Action Plan Approvals</h3><div class="space-y-3"><div class="bg-slate-50 dark:bg-gray-800/50 p-3 rounded-lg"><p class="font-semibold text-slate-700 dark:text-gray-200">Maharashtra AAP FY25</p><p class="text-sm text-slate-500 dark:text-gray-400">Submitted: 10 Oct 2025 | Value: ₹12,500 Cr</p><div class="flex space-x-2 mt-2"><button class="w-full bg-indigo-600 text-white py-1.5 rounded-md text-sm font-semibold hover:bg-indigo-700">Approve</button><button class="w-full bg-slate-200 dark:bg-gray-600 text-slate-800 dark:text-gray-200 py-1.5 rounded-md text-sm font-semibold hover:bg-slate-300">Review</button></div></div><div class="bg-slate-50 dark:bg-gray-800/50 p-3 rounded-lg"><p class="font-semibold text-slate-700 dark:text-gray-200">Uttar Pradesh AAP FY25</p><p class="text-sm text-slate-500 dark:text-gray-400">Submitted: 08 Oct 2025 | Value: ₹18,200 Cr</p><div class="flex space-x-2 mt-2"><button class="w-full bg-indigo-600 text-white py-1.5 rounded-md text-sm font-semibold hover:bg-indigo-700">Approve</button><button class="w-full bg-slate-200 dark:bg-gray-600 text-slate-800 dark:text-gray-200 py-1.5 rounded-md text-sm font-semibold hover:bg-slate-300">Review</button></div></div><p class="text-sm text-center text-indigo-600 dark:text-indigo-400 hover:underline cursor-pointer">View All 5 Pending Approvals</p></div></div>
                <div class="card p-5"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Fund Management</h3><div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg text-center"><p class="text-slate-500 dark:text-gray-400 font-medium">Unallocated / Excess Funds</p><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 my-2">₹850 Cr</p><p class="text-xs text-slate-500 dark:text-gray-400">Available for redistribution from low-performing states.</p><button class="mt-3 w-full bg-green-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-green-700">Initiate Redistribution</button></div><div class="mt-4"><h4 class="font-semibold text-slate-600 dark:text-gray-300">Recent Fund Flow</h4><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">₹500 Cr released to Rajasthan for Adarsh Gram component.</p></div></div>
                <div class="card p-5"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Policy Analytics Engine</h3><div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg"><div class="flex items-start space-x-3"><i data-lucide="brain-circuit" class="w-8 h-8 text-indigo-500 mt-1 flex-shrink-0"></i><div><h4 class="font-semibold text-slate-700 dark:text-gray-200">AI-Powered Insights</h4><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Simulate policy changes, analyze fund convergence opportunities, and forecast scheme outcomes.</p></div></div><button class="mt-4 w-full bg-indigo-100 text-indigo-700 dark:bg-indigo-500/10 dark:text-indigo-400 py-2 rounded-lg text-sm font-semibold hover:bg-indigo-200">Launch Analytics Suite</button></div></div>
            </div>
        </div>

        <div id="projects-view" class="hidden">
            </div>

        <div id="state-performance-view" class="hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                <div>
                    <button id="back-to-national" class="flex items-center text-sm font-medium text-slate-500 hover:text-slate-800 dark:text-gray-400 dark:hover:text-gray-200 mb-2">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                        Back to National View
                    </button>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">Performance Dashboard: <span id="state-name-title" class="text-indigo-600"></span></h2>
                    <p class="text-slate-500 dark:text-gray-400 mt-1">Detailed operational and financial overview</p>
                </div>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                  <select id="state-selector-dropdown" class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300">
                       <option>Maharashtra</option>
                       <option>Gujarat</option>
                       <option>Uttar Pradesh</option>
                       <option>Bihar</option>
                  </select>
                  <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300"><option>All Districts</option><option>Nagpur</option><option>Pune</option></select>
                  <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300"><option>FY 2025-26</option><option>FY 2024-25</option></select>
                  <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300"><option>All Components</option><option>Adarsh Gram</option><option>GIA</option><option>Hostel</option></select>
            </div>
            <div class="card p-5 mb-6">
                <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">"Treasury Tracker" - Fund Flow</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div id="treasury-received" class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                        <p class="text-sm text-slate-500 dark:text-gray-400">Received from Center</p>
                        <p class="text-2xl font-bold text-slate-800 dark:text-gray-100 mt-1"></p>
                        <p class="text-xs text-slate-400 dark:text-gray-500"></p>
                    </div>
                    <div id="treasury-pending" class="p-4 rounded-lg">
                        <p class="text-sm font-medium">Time in State Treasury</p>
                        <p class="text-2xl font-bold mt-1"></p>
                        <p class="text-xs"></p>
                    </div>
                    <div id="treasury-released" class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                        <p class="text-sm text-slate-500 dark:text-gray-400">Released to Districts</p>
                        <p class="text-2xl font-bold text-slate-800 dark:text-gray-100 mt-1"></p>
                        <p class="text-xs text-slate-400 dark:text-gray-500"></p>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="card p-5"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Smart UC Generation Funnel</h3><div class="h-64"><canvas id="ucFunnelChart"></canvas></div></div>
                <div class="card p-5">
                    <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Triangulation of Verification Health</h3>
                    <div class="space-y-4 pt-2">
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span class="font-medium text-slate-600 dark:text-gray-300">Official (Photos)</span><span id="verify-official-perc" class="text-slate-500 dark:text-gray-400"></span></div>
                            <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2.5"><div id="verify-official-bar" class="bg-blue-600 h-2.5 rounded-full"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span class="font-medium text-slate-600 dark:text-gray-300">Beneficiary (IVR)</span><span id="verify-beneficiary-perc" class="text-slate-500 dark:text-gray-400"></span></div>
                            <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2.5"><div id="verify-beneficiary-bar" class="bg-green-600 h-2.5 rounded-full"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1"><span class="font-medium text-slate-600 dark:text-gray-300">Community (Social Audit)</span><span id="verify-community-perc" class="text-slate-500 dark:text-gray-400"></span></div>
                            <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2.5"><div id="verify-community-bar" class="bg-amber-500 h-2.5 rounded-full"></div></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-2">Predictive Risk Alerts</h3>
                        <div id="risk-alert-card" class="text-sm p-2 rounded"></div>
                    </div>
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-2">AI Convergence Opportunity</h3>
                        <div id="convergence-card" class="text-sm p-2 rounded"></div>
                    </div>
                </div>
            </div>
            <div class="card p-5">
                <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">District-wise Performance</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800">
                            <tr>
                                <th class="px-4 py-3">District</th>
                                <th class="px-4 py-3 text-center">Fund Release Velocity (Days)</th>
                                <th class="px-4 py-3 text-center">UC Submission %</th>
                                <th class="px-4 py-3 text-center">On-Time Completion %</th>
                                <th class="px-4 py-3 text-center">Data Quality Score</th>
                            </tr>
                        </thead>
                        <tbody id="districts-table-body" class="dark:text-gray-300 divide-y dark:divide-gray-700">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="fund-management-view" class="hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">Financial Command Center</h2>
                    <p class="text-slate-500 dark:text-gray-400 mt-1">Oversee, analyze, and manage national fund allocation.</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Sanctioned Budget (FY25)</h3><div class="p-2 bg-indigo-100 dark:bg-indigo-500/10 rounded-md"><i data-lucide="building-2" class="w-5 h-5 text-indigo-600 dark:text-indigo-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹2 Lakh Cr</p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Disbursed to States</h3><div class="p-2 bg-blue-100 dark:bg-blue-500/10 rounded-md"><i data-lucide="send" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹1.25 Lakh Cr</p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Held in State Treasuries</h3><div class="p-2 bg-red-100 dark:bg-red-500/10 rounded-md"><i data-lucide="hourglass" class="w-5 h-5 text-red-600 dark:text-red-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹42,000 Cr</p></div>
                <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">For Redistribution</h3><div class="p-2 bg-green-100 dark:bg-green-500/10 rounded-md"><i data-lucide="recycle" class="w-5 h-5 text-green-600 dark:text-green-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹850 Cr</p></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 flex flex-col gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Disbursement vs. Utilization (Quarterly)</h3>
                        <div class="h-64"><canvas id="disbursementTrendChart"></canvas></div>
                    </div>
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Allocation by Component</h3>
                        <div class="h-64"><canvas id="componentAllocationChart"></canvas></div>
                    </div>
                </div>

                <div class="lg:col-span-2 flex flex-col gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Strategic Fund Redistribution</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                                <h4 class="font-semibold text-slate-700 dark:text-gray-200 mb-2">Sources (Under-utilized Funds)</h4>
                                <div class="space-y-2 text-sm text-slate-600 dark:text-gray-300">
                                    <div class="flex justify-between items-center">
                                        <p>Jharkhand <span class="text-xs text-red-600 dark:text-red-400">(38.9%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">₹350 Cr</p>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <p>Bihar <span class="text-xs text-red-600 dark:text-red-400">(42.7%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">₹300 Cr</p>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <p>West Bengal <span class="text-xs text-red-600 dark:text-red-400">(45.1%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">₹200 Cr</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                                <h4 class="font-semibold text-slate-700 dark:text-gray-200 mb-2">Destinations (High-performing)</h4>
                                <div class="space-y-2 text-sm text-slate-600 dark:text-gray-300">
                                    <div class="flex justify-between items-center">
                                        <p>Gujarat <span class="text-xs text-green-600 dark:text-green-400">(94.2%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">Needs ₹500 Cr</p>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <p>Tamil Nadu <span class="text-xs text-green-600 dark:text-green-400">(93.5%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">Needs ₹450 Cr</p>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <p>Kerala <span class="text-xs text-green-600 dark:text-green-400">(92.1%)</span></p>
                                        <p class="font-bold text-slate-800 dark:text-gray-100">Needs ₹250 Cr</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button class="mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700">Propose Redistribution Plan</button>
                    </div>

                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">UC Gridlock Management</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3">State</th>
                                        <th class="px-4 py-3 text-right">Pending UC Value</th>
                                        <th class="px-4 py-3 text-center">Stalled Projects</th>
                                        <th class="px-4 py-3 text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="dark:text-gray-300 divide-y dark:divide-gray-700">
                                    <tr><td class="px-4 py-3 font-medium">Bihar</td><td class="px-4 py-3 text-right font-semibold text-red-600 dark:text-red-400">₹8,200 Cr</td><td class="px-4 py-3 text-center">490</td><td class="px-4 py-3 text-center"><button class="text-xs bg-red-100 text-red-700 font-semibold py-1 px-2 rounded dark:bg-red-500/10 dark:text-red-300">Flag</button></td></tr>
                                    <tr><td class="px-4 py-3 font-medium">Uttar Pradesh</td><td class="px-4 py-3 text-right font-semibold text-red-600 dark:text-red-400">₹7,500 Cr</td><td class="px-4 py-3 text-center">650</td><td class="px-4 py-3 text-center"><button class="text-xs bg-red-100 text-red-700 font-semibold py-1 px-2 rounded dark:bg-red-500/10 dark:text-red-300">Flag</button></td></tr>
                                    <tr><td class="px-4 py-3 font-medium">West Bengal</td><td class="px-4 py-3 text-right font-semibold text-amber-600 dark:text-amber-400">₹5,100 Cr</td><td class="px-4 py-3 text-center">320</td><td class="px-4 py-3 text-center"><button class="text-xs bg-amber-100 text-amber-700 font-semibold py-1 px-2 rounded dark:bg-amber-500/10 dark:text-amber-300">Flag</button></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="policy-analytics-view" class="hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">Policy Analytics & Simulation</h2>
                    <p class="text-slate-500 dark:text-gray-400 mt-1">Model, forecast, and design evidence-based policies.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 flex flex-col gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">Policy Simulation Sandbox</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="sim-skill-dev" class="block text-sm font-medium text-slate-700 dark:text-gray-300">Skill Development Allocation</label>
                                <div class="flex items-center gap-4">
                                    <input id="sim-skill-dev" type="range" min="0" max="100" value="10" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                                    <span id="sim-skill-dev-label" class="font-semibold text-slate-800 dark:text-gray-100 w-12 text-right">10%</span>
                                </div>
                            </div>
                            <div>
                                <label for="sim-adarsh-gram" class="block text-sm font-medium text-slate-700 dark:text-gray-300">Adarsh Gram Allocation</label>
                                <div class="flex items-center gap-4">
                                    <input id="sim-adarsh-gram" type="range" min="0" max="100" value="40" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                                    <span id="sim-adarsh-gram-label" class="font-semibold text-slate-800 dark:text-gray-100 w-12 text-right">40%</span>
                                </div>
                            </div>
                            <button id="run-simulation-btn" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 flex items-center justify-center">
                                <i data-lucide="play" class="w-5 h-5 mr-2"></i> Run Simulation
                            </button>
                        </div>
                    </div>
                    <div class="card p-5">
                         <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-4">AI Convergence Engine</h3>
                         <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300 mb-3">
                               <option>Select a State to Analyze</option>
                               <option>Uttar Pradesh</option>
                               <option>Maharashtra</option>
                         </select>
                         <div class="bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 p-3 rounded-lg text-sm">
                               <p><strong>Opportunity Found:</strong> <strong>45 projects</strong> in Uttar Pradesh overlap with PMAY. Converging these could save an estimated <strong>₹35 Cr</strong> in FY25.</p>
                         </div>
                    </div>
                </div>

                <div class="lg:col-span-2 flex flex-col gap-6">
                    <div class="card p-5">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-2">Predicted National Outcomes</h3>
                        <p class="text-sm text-slate-500 dark:text-gray-400 mb-4">Based on your simulated policy changes.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                            <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-500 dark:text-gray-400">Fund Utilization</p>
                                <p id="sim-output-utilization" class="text-3xl font-bold text-slate-800 dark:text-gray-100 mt-1">62.5%</p>
                                <p id="sim-output-utilization-change" class="text-sm font-semibold"></p>
                            </div>
                            <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-500 dark:text-gray-400">On-Time Completion</p>
                                <p id="sim-output-completion" class="text-3xl font-bold text-slate-800 dark:text-gray-100 mt-1">81.0%</p>
                                <p id="sim-output-completion-change" class="text-sm font-semibold"></p>
                            </div>
                            <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-500 dark:text-gray-400">High-Risk Projects</p>
                                <p id="sim-output-risk" class="text-3xl font-bold text-slate-800 dark:text-gray-100 mt-1">842</p>
                                <p id="sim-output-risk-change" class="text-sm font-semibold"></p>
                            </div>
                        </div>
                    </div>
                     <div class="card p-5">
                          <h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100 mb-2">Forecasted Beneficiary Impact</h3>
                           <p class="text-sm text-slate-500 dark:text-gray-400 mb-4">Predicted socio-economic changes for beneficiaries.</p>
                           <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                               <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg flex items-center gap-4">
                                   <div class="p-3 bg-blue-100 dark:bg-blue-500/10 rounded-full">
                                       <i data-lucide="indian-rupee" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                   </div>
                                   <div>
                                       <p class="text-sm font-medium text-slate-500 dark:text-gray-400">Avg. Household Income</p>
                                       <p id="sim-output-income-change" class="text-xl font-bold text-green-600 dark:text-green-400">+ 0.0%</p>
                                   </div>
                               </div>
                               <div class="bg-slate-50 dark:bg-gray-800/50 p-4 rounded-lg flex items-center gap-4">
                                    <div class="p-3 bg-green-100 dark:bg-green-500/10 rounded-full">
                                         <i data-lucide="award" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                                    </div>
                                   <div>
                                       <p class="text-sm font-medium text-slate-500 dark:text-gray-400">Skill Certifications</p>
                                       <p id="sim-output-skill-change" class="text-xl font-bold text-green-600 dark:text-green-400">+ 0.0%</p>
                                   </div>
                               </div>
                          </div>
                     </div>
                </div>
            </div>
        </div>

        <div id="approvals-view" class="hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">Approval Command Center</h2>
                    <p class="text-slate-500 dark:text-gray-400 mt-1">Manage and review all pending proposals and action plans.</p>
                </div>
            </div>

            <div class="card p-4 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300">
                        <option>All Types</option>
                        <option>Annual Action Plan</option>
                        <option>Fund Redistribution</option>
                        <option>Special Project</option>
                    </select>
                     <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300">
                        <option>All States</option>
                        <option>Maharashtra</option>
                        <option>Uttar Pradesh</option>
                        <option>Bihar</option>
                        <option>Rajasthan</option>
                    </select>
                    <select class="w-full bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300">
                        <option>All Status</option>
                        <option>Pending</option>
                        <option>Under Review</option>
                        <option>Approved</option>
                        <option>Rejected</option>
                    </select>
                    <input type="text" placeholder="Search by name or ID..." class="w-full md:col-span-2 lg:col-span-2 bg-white dark:bg-gray-800 border border-slate-300 dark:border-gray-600 rounded-md shadow-sm p-2 text-sm text-slate-700 dark:text-gray-300" />
                </div>
            </div>
            
            <div class="space-y-4" id="approvals-list-container">
            </div>
        </div>

        <div id="feedback-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div class="card w-full max-w-2xl max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center p-5 border-b border-slate-200 dark:border-gray-700 flex-shrink-0">
                    <div>
                        <h3 id="feedback-modal-title" class="text-lg font-semibold text-slate-800 dark:text-gray-100">Public Feedback</h3>
                        <p id="feedback-modal-subtitle" class="text-sm text-slate-500 dark:text-gray-400">Project: North Delhi Infra Grant</p>
                    </div>
                    <button id="close-feedback-modal-btn" class="p-1 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700">
                        <i data-lucide="x" class="w-5 h-5 text-slate-600 dark:text-gray-400"></i>
                    </button>
                </div>
    
                <div class="p-6 overflow-y-auto modal-body space-y-5">
                    <div class="p-4 rounded-lg bg-slate-50 dark:bg-gray-800/50">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <p class="font-semibold text-slate-800 dark:text-gray-100">Ravi Kumar</p>
                                <p class="text-xs text-slate-500 dark:text-gray-400">10 Oct, 2025</p>
                            </div>
                            <div class="flex items-center text-yellow-500">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4"></i>
                                <span class="text-xs ml-2 text-slate-600 dark:text-gray-300">(4/5)</span>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 dark:text-gray-300">The construction work is progressing well, but the material storage is causing some traffic issues in the evening.</p>
                    </div>
                    <div class="p-4 rounded-lg bg-slate-50 dark:bg-gray-800/50">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <p class="font-semibold text-slate-800 dark:text-gray-100">Sunita Devi</p>
                                <p class="text-xs text-slate-500 dark:text-gray-400">08 Oct, 2025</p>
                            </div>
                            <div class="flex items-center text-yellow-500">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <span class="text-xs ml-2 text-slate-600 dark:text-gray-300">(5/5)</span>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 dark:text-gray-300">Very happy with the quality of the road being built. The engineers are professional and listen to our concerns.</p>
                    </div>
                     <div class="p-4 rounded-lg bg-slate-50 dark:bg-gray-800/50">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <p class="font-semibold text-slate-800 dark:text-gray-100">Anonymous</p>
                                <p class="text-xs text-slate-500 dark:text-gray-400">05 Oct, 2025</p>
                            </div>
                            <div class="flex items-center text-yellow-500">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4"></i><i data-lucide="star" class="w-4 h-4"></i><i data-lucide="star" class="w-4 h-4"></i>
                                <span class="text-xs ml-2 text-slate-600 dark:text-gray-300">(2/5)</span>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 dark:text-gray-300">Work is very slow and often stops for days. We were told it would be faster.</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            lucide.createIcons();

            // --- View Management ---
            const views = {
                national: document.getElementById('national-dashboard-view'),
                state: document.getElementById('state-performance-view'),
                projects: document.getElementById('projects-view'),
                fundManagement: document.getElementById('fund-management-view'),
                policyAnalytics: document.getElementById('policy-analytics-view'),
                approvals: document.getElementById('approvals-view')
            };

            const navLinks = {
                dashboard: document.getElementById('nav-dashboard'),
                projects: document.getElementById('nav-projects'),
                statePerformance: document.getElementById('nav-state-performance'),
                fundManagement: document.getElementById('nav-fund-management'),
                policyAnalytics: document.getElementById('nav-policy-analytics'),
                approvals: document.getElementById('nav-approvals')
            };

            const backToNationalBtn = document.getElementById('back-to-national');
            
            const showView = (viewToShow) => {
                Object.values(views).forEach(view => view.classList.add('hidden'));
                Object.values(navLinks).forEach(link => {
                    link.classList.remove('bg-indigo-50', 'dark:bg-white', 'dark:text-slate-900', 'font-semibold');
                    link.classList.add('text-slate-600', 'dark:text-gray-400', 'font-medium');
                });
                
                let activeLink;
                if (views[viewToShow]) {
                    views[viewToShow].classList.remove('hidden');
                    activeLink = navLinks[viewToShow === 'national' ? 'dashboard' : viewToShow];
                }

                if (activeLink) {
                    activeLink.classList.add('bg-indigo-50', 'dark:bg-white', 'dark:text-slate-900', 'font-semibold');
                    activeLink.classList.remove('text-slate-600', 'dark:text-gray-400', 'font-medium');
                }
            };
            
            navLinks.dashboard.addEventListener('click', (e) => { e.preventDefault(); showView('national'); });
            navLinks.projects.addEventListener('click', (e) => { e.preventDefault(); showView('projects'); });
            navLinks.statePerformance.addEventListener('click', (e) => { e.preventDefault(); updateStateView('Maharashtra'); showView('state'); });
            navLinks.fundManagement.addEventListener('click', (e) => { e.preventDefault(); updateFundManagementView(); showView('fundManagement'); });
            navLinks.policyAnalytics.addEventListener('click', (e) => { e.preventDefault(); showView('policyAnalytics'); });
            navLinks.approvals.addEventListener('click', (e) => { e.preventDefault(); showView('approvals'); });
            backToNationalBtn.addEventListener('click', (e) => { e.preventDefault(); showView('national'); });
            
            // --- Theme Toggling Logic ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');

            const setTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
                lightIcon.classList.toggle('hidden', isDark);
                darkIcon.classList.toggle('hidden', !isDark);
            };

            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedTheme = localStorage.getItem('theme') === 'dark';
            setTheme(savedTheme || prefersDark);
            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                setTheme(isDark);
            });

            // --- INTERACTIVE HEATMAP LOGIC ---
            const stateUtilizationData = {'IN-GJ': 94.2,'IN-MH': 91.8,'IN-KA': 89.5,'IN-AP': 88.0,'IN-TN': 93.5,'IN-KL': 92.1,'IN-TG': 85.3,'IN-HR': 90.5,'IN-MP': 81.1,'IN-RJ': 72.3,'IN-UP': 65.0,'IN-PB': 78.9,'IN-WB': 45.1,'IN-BR': 42.7,'IN-JH': 38.9,'IN-OR': 55.4,'IN-CT': 61.2,'IN-AS': 58.0,'IN-HP': 75.5,'IN-UA': 71.0,'IN-JK': 68.2,'IN-AR': 52.3,'IN-SK': 82.0};
            const map = document.getElementById('india-map-svg');
            const tooltip = document.getElementById('tooltip');
            const states = document.querySelectorAll('#india-map-svg .state');
            
            function colorMap() {
                states.forEach(state => {
                    const utilization = stateUtilizationData[state.id];
                    state.classList.remove('high-utilization', 'medium-utilization', 'low-utilization', 'no-data');
                    if (utilization === undefined) state.classList.add('no-data');
                    else if (utilization > 90) state.classList.add('high-utilization');
                    else if (utilization >= 60) state.classList.add('medium-utilization');
                    else state.classList.add('low-utilization');
                });
            }

            states.forEach(state => {
                state.addEventListener('click', function() {
                    const stateName = state.dataset.name;
                    if(mockStateData[stateName]) {
                        updateStateView(stateName);
                        showView('state');
                    } else {
                        console.warn(`No detailed data available for ${stateName} in this demo.`);
                    }
                });
                state.addEventListener('mouseover', (event) => {
                    const stateName = state.dataset.name;
                    const utilization = stateUtilizationData[state.id];
                    tooltip.innerHTML = utilization !== undefined ? `<strong>${stateName}</strong><br>Utilization: ${utilization}%` : `<strong>${stateName}</strong><br>No Data`;
                    tooltip.style.display = 'block';
                });
                state.addEventListener('mousemove', (event) => {
                    const rect = document.getElementById('map-container').getBoundingClientRect();
                    tooltip.style.left = (event.clientX - rect.left + 15) + 'px';
                    tooltip.style.top = (event.clientY - rect.top + 15) + 'px';
                });
                state.addEventListener('mouseout', () => { tooltip.style.display = 'none'; });
            });
            colorMap();

            // --- Chart.js Instances ---
            const ucFunnelCtx = document.getElementById('ucFunnelChart').getContext('2d');
            const ucFunnelChart = new Chart(ucFunnelCtx, {
                type: 'bar',
                data: {
                    labels: ['Projects Completed', 'Photo Proof Submitted', 'UCs Auto-Generated', 'UCs Approved'],
                    datasets: [{ label: 'Count', data: [], backgroundColor: ['rgba(79, 70, 229, 0.7)','rgba(5, 150, 105, 0.7)','rgba(2, 132, 199, 0.7)','rgba(217, 70, 239, 0.7)'], borderWidth: 0, barPercentage: 1.0, categoryPercentage: 0.7 }]
                },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { grid: { color: () => document.documentElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : '#e5e7eb' }, ticks: { color: () => document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280' } }, y: { grid: { display: false }, ticks: { color: () => document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280' } } }, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => ` ${context.raw} projects` } } } }
            });
            
            // --- MOCK DATA ---
            const mockStateData = { 'Maharashtra': { treasury: { received: '₹12,500 Cr', receivedDate: 'on 01 Oct 2025', time: 22, sla: 15, released: '₹11,800 Cr', releasedDate: 'on 23 Oct 2025'}, ucFunnel: [1200, 1150, 1100, 1050], verification: { official: 95, beneficiary: 88, community: 75 }, riskAlert: { type: 'high', text: '<strong>High Risk:</strong> Hostel, Nagpur. Procurement delay predicted.' }, convergence: { text: '<strong>15 projects</strong> in Yavatmal overlap with PMGSY. Est. saving: <strong>₹12 Cr</strong>.' }, districts: [ { name: 'Pune', velocity: 12, uc: 99, completion: 92, quality: 98 }, { name: 'Nagpur', velocity: 20, uc: 85, completion: 81, quality: 95 }, { name: 'Nashik', velocity: 14, uc: 96, completion: 89, quality: 88 }, { name: 'Yavatmal', velocity: 35, uc: 65, completion: 70, quality: 75 } ] }, 'Gujarat': { treasury: { received: '₹15,000 Cr', receivedDate: 'on 28 Sep 2025', time: 10, sla: 15, released: '₹15,000 Cr', releasedDate: 'on 08 Oct 2025'}, ucFunnel: [1800, 1790, 1785, 1780], verification: { official: 99, beneficiary: 96, community: 92 }, riskAlert: { type: 'low', text: '<strong>Low Risk:</strong> All projects on track.' }, convergence: { text: '<strong>8 projects</strong> in Ahmedabad overlap with NREGA. Est. saving: <strong>₹8 Cr</strong>.' }, districts: [ { name: 'Ahmedabad', velocity: 8, uc: 99, completion: 98, quality: 99 }, { name: 'Surat', velocity: 10, uc: 98, completion: 97, quality: 98 } ] }, 'Uttar Pradesh': { treasury: { received: '₹18,200 Cr', receivedDate: 'on 01 Oct 2025', time: 28, sla: 15, released: '₹15,000 Cr', releasedDate: 'on 29 Oct 2025'}, ucFunnel: [2500, 2300, 2000, 1850], verification: { official: 85, beneficiary: 78, community: 65 }, riskAlert: { type: 'high', text: '<strong>High Risk:</strong> Adarsh Gram, Lucknow. Land acquisition issues predicted.' }, convergence: { text: '<strong>45 projects</strong> across 5 districts overlap with PMAY. Est. saving: <strong>₹35 Cr</strong>.' }, districts: [ { name: 'Lucknow', velocity: 25, uc: 75, completion: 72, quality: 80 }, { name: 'Kanpur', velocity: 28, uc: 70, completion: 68, quality: 75 } ] }, 'Bihar': { treasury: { received: '₹9,800 Cr', receivedDate: 'on 05 Oct 2025', time: 45, sla: 15, released: '₹7,000 Cr', releasedDate: 'on 19 Nov 2025'}, ucFunnel: [900, 750, 500, 410], verification: { official: 70, beneficiary: 62, community: 55 }, riskAlert: { type: 'high', text: '<strong>Critical Risk:</strong> Multiple projects show signs of fund diversion.' }, convergence: { text: '<strong>Low convergence</strong> identified. Opportunity to train officials.' }, districts: [ { name: 'Patna', velocity: 40, uc: 60, completion: 55, quality: 65 }, { name: 'Gaya', velocity: 48, uc: 55, completion: 50, quality: 60 } ] } };
            const mockApprovalsData = [
                { id: 'APP-MH-001', title: 'Maharashtra AAP FY26', submittedBy: 'Govt. of Maharashtra', type: 'Annual Action Plan', value: '₹12,500 Cr', date: '2025-10-10', status: 'Pending', risk: { score: 'Low', text: 'Low Risk | 92% Success Probability' } },
                { id: 'APP-UP-001', title: 'Uttar Pradesh AAP FY26', submittedBy: 'Govt. of Uttar Pradesh', type: 'Annual Action Plan', value: '₹18,200 Cr', date: '2025-10-08', status: 'Pending', risk: { score: 'Medium', text: 'Medium Risk | 75% Success Probability' } },
                { id: 'APP-RJ-001', title: 'Rajasthan Special Project Grant', submittedBy: 'Govt. of Rajasthan', type: 'Special Project', value: '₹500 Cr', date: '2025-10-05', status: 'Under Review', risk: { score: 'Low', text: 'Low Risk | 88% Success Probability' } },
                { id: 'APP-BR-001', title: 'Bihar Fund Redistribution Proposal', submittedBy: 'Govt. of Bihar', type: 'Fund Redistribution', value: '₹300 Cr', date: '2025-10-02', status: 'Rejected', risk: { score: 'High', text: 'High Risk | 45% Success Probability' } },
                 { id: 'APP-GJ-001', title: 'Gujarat AAP FY26', submittedBy: 'Govt. of Gujarat', type: 'Annual Action Plan', value: '₹15,000 Cr', date: '2025-09-28', status: 'Approved', risk: { score: 'Low', text: 'Low Risk | 99% Success Probability' } },
            ];
            
            const stateSelector = document.getElementById('state-selector-dropdown');
            stateSelector.addEventListener('change', function() { updateStateView(this.value); });

            // --- STATE VIEW LOGIC ---
            function updateStateView(stateName) {
                const data = mockStateData[stateName]; if (!data) return;
                document.getElementById('state-name-title').textContent = stateName;
                stateSelector.value = stateName;
                const treasuryReceived = document.querySelector('#treasury-received p:nth-child(2)'), treasuryReceivedDate = document.querySelector('#treasury-received p:nth-child(3)'), treasuryPending = document.getElementById('treasury-pending'), treasuryPendingTime = document.querySelector('#treasury-pending p:nth-child(2)'), treasuryPendingSLA = document.querySelector('#treasury-pending p:nth-child(3)'), treasuryReleased = document.querySelector('#treasury-released p:nth-child(2)'), treasuryReleasedDate = document.querySelector('#treasury-released p:nth-child(3)');
                treasuryReceived.textContent = data.treasury.received; treasuryReceivedDate.textContent = data.treasury.receivedDate; treasuryReleased.textContent = data.treasury.released; treasuryReleasedDate.textContent = data.treasury.releasedDate; treasuryPendingTime.textContent = `${data.treasury.time} Days`; treasuryPendingSLA.textContent = `SLA: ${data.treasury.sla} Days`;
                treasuryPending.className = 'p-4 rounded-lg text-center';
                if (data.treasury.time > data.treasury.sla) {
                    treasuryPending.classList.add('bg-red-50', 'dark:bg-red-900/20', 'border', 'border-red-500/50');
                    document.querySelector('#treasury-pending p:nth-child(1)').className = 'text-sm font-medium text-red-600 dark:text-red-400';
                    treasuryPendingTime.className = 'text-2xl font-bold mt-1 text-red-700 dark:text-red-300';
                    treasuryPendingSLA.className = 'text-xs text-red-500 dark:text-red-500';
                } else {
                    treasuryPending.classList.add('bg-slate-50', 'dark:bg-gray-800/50');
                    document.querySelector('#treasury-pending p:nth-child(1)').className = 'text-sm font-medium text-slate-500 dark:text-gray-400';
                    treasuryPendingTime.className = 'text-2xl font-bold mt-1 text-slate-800 dark:text-gray-100';
                    treasuryPendingSLA.className = 'text-xs text-slate-400 dark:text-gray-500';
                }
                ucFunnelChart.data.datasets[0].data = data.ucFunnel; ucFunnelChart.update();
                document.getElementById('verify-official-perc').textContent = `${data.verification.official}%`; document.getElementById('verify-official-bar').style.width = `${data.verification.official}%`; document.getElementById('verify-beneficiary-perc').textContent = `${data.verification.beneficiary}%`; document.getElementById('verify-beneficiary-bar').style.width = `${data.verification.beneficiary}%`; document.getElementById('verify-community-perc').textContent = `${data.verification.community}%`; document.getElementById('verify-community-bar').style.width = `${data.verification.community}%`;
                const riskCard = document.getElementById('risk-alert-card'), convergenceCard = document.getElementById('convergence-card');
                riskCard.innerHTML = data.riskAlert.text; convergenceCard.innerHTML = data.convergence.text;
                riskCard.className = 'text-sm p-2 rounded';
                if (data.riskAlert.type === 'high') riskCard.classList.add('text-red-600', 'dark:text-red-400', 'bg-red-50', 'dark:bg-red-900/20'); else riskCard.classList.add('text-green-700', 'dark:text-green-300', 'bg-green-50', 'dark:bg-green-900/20');
                convergenceCard.className = 'text-sm p-2 rounded'; convergenceCard.classList.add('bg-green-50', 'dark:bg-green-900/20', 'text-green-700', 'dark:text-green-300');
                const tableBody = document.getElementById('districts-table-body'); tableBody.innerHTML = '';
                const colorClass = (value, highGood = true) => { if (highGood) { if (value > 90) return 'text-green-600 dark:text-green-400'; if (value > 75) return 'text-amber-600 dark:text-amber-400'; return 'text-red-600 dark:text-red-400'; } else { if (value < 15) return 'text-green-600 dark:text-green-400'; if (value < 30) return 'text-amber-600 dark:text-amber-400'; return 'text-red-600 dark:text-red-400'; } };
                data.districts.forEach(district => { const row = `<tr><td class="px-4 py-3 font-medium">${district.name}</td><td class="px-4 py-3 text-center ${colorClass(district.velocity, false)}">${district.velocity}</td><td class="px-4 py-3 text-center ${colorClass(district.uc)}">${district.uc}%</td><td class="px-4 py-3 text-center ${colorClass(district.completion)}">${district.completion}%</td><td class="px-4 py-3 text-center ${colorClass(district.quality)}">${district.quality}%</td></tr>`; tableBody.innerHTML += row; });
            }
            
            // --- Fund Management View Logic ---
            let disbursementTrendChart, componentAllocationChart;
            function updateFundManagementView() {
                const trendCtx = document.getElementById('disbursementTrendChart').getContext('2d');
                const allocationCtx = document.getElementById('componentAllocationChart').getContext('2d');
                if (disbursementTrendChart) disbursementTrendChart.destroy();
                disbursementTrendChart = new Chart(trendCtx, { type: 'line', data: { labels: ['Q4 FY24', 'Q1 FY25', 'Q2 FY25', 'Q3 FY25'], datasets: [ { label: 'Disbursed (₹ Lakh Cr)', data: [0.9, 1.1, 1.2, 1.25], borderColor: '#3b82f6', tension: 0.1, fill: false }, { label: 'Utilized (₹ Lakh Cr)', data: [0.75, 0.85, 0.95, 1.05], borderColor: '#16a34a', tension: 0.1, fill: false } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } });
                if (componentAllocationChart) componentAllocationChart.destroy();
                componentAllocationChart = new Chart(allocationCtx, { type: 'doughnut', data: { labels: ['Adarsh Gram', 'Grant-in-Aid', 'Hostels', 'Skill Development'], datasets: [{ data: [40, 30, 20, 10], backgroundColor: ['#3b82f6', '#16a34a', '#f59e0b', '#ef4444'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
            }

            // --- Policy Analytics Logic ---
            const simSkillSlider = document.getElementById('sim-skill-dev');
            const simSkillLabel = document.getElementById('sim-skill-dev-label');
            const simAdarshGramSlider = document.getElementById('sim-adarsh-gram');
            const simAdarshGramLabel = document.getElementById('sim-adarsh-gram-label');
            const runSimBtn = document.getElementById('run-simulation-btn');
            simSkillSlider.addEventListener('input', (e) => simSkillLabel.textContent = `${e.target.value}%`);
            simAdarshGramSlider.addEventListener('input', (e) => simAdarshGramLabel.textContent = `${e.target.value}%`);
            runSimBtn.addEventListener('click', () => {
                const skillAlloc = parseInt(simSkillSlider.value);
                const adarshAlloc = parseInt(simAdarshGramSlider.value);
                const baseUtilization = 62.5, baseCompletion = 81.0, baseRisk = 842, baseIncome = 0.0, baseSkill = 0.0;
                const utilizationChange = (skillAlloc - 10) * 0.2 + (adarshAlloc - 40) * 0.1;
                const completionChange = (skillAlloc - 10) * 0.15 + (adarshAlloc - 40) * 0.12;
                const riskChange = (skillAlloc - 10) * -2.5 + (adarshAlloc - 40) * -1.5;
                const incomeChange = (adarshAlloc - 40) * 0.05;
                const skillChange = (skillAlloc - 10) * 0.25;
                updateSimOutput('sim-output-utilization', baseUtilization, utilizationChange, '%', 1);
                updateSimOutput('sim-output-completion', baseCompletion, completionChange, '%', 1);
                updateSimOutput('sim-output-risk', baseRisk, riskChange, '', 0);
                updateSimOutput('sim-output-income-change', baseIncome, incomeChange, '%', 1, true);
                updateSimOutput('sim-output-skill-change', baseSkill, skillChange, '%', 1, true);
            });
            function updateSimOutput(elementId, base, change, unit, decimals, isJustChange = false) {
                const changeEl = isJustChange ? document.getElementById(elementId) : document.getElementById(`${elementId}-change`);
                const valueEl = isJustChange ? null : document.getElementById(elementId);
                if (!isJustChange) { valueEl.textContent = `${(base + change).toFixed(decimals)}${unit}`; }
                changeEl.textContent = `${change > 0 ? '+' : ''}${change.toFixed(decimals)}${unit}`;
                changeEl.classList.remove('text-green-600', 'dark:text-green-400', 'text-red-600', 'dark:text-red-400');
                if (change > 0) { changeEl.classList.add('text-green-600', 'dark:text-green-400'); } else if (change < 0) { changeEl.classList.add('text-red-600', 'dark:text-red-400'); }
            }

            // --- APPROVALS VIEW LOGIC ---
            function updateApprovalsView() {
                const container = document.getElementById('approvals-list-container');
                container.innerHTML = ''; // Clear existing items

                const statusClasses = {
                    'Pending': 'text-amber-700 bg-amber-100 dark:text-amber-200 dark:bg-amber-500/20',
                    'Under Review': 'text-blue-700 bg-blue-100 dark:text-blue-200 dark:bg-blue-500/20',
                    'Approved': 'text-green-700 bg-green-100 dark:text-green-200 dark:bg-green-500/20',
                    'Rejected': 'text-red-700 bg-red-100 dark:text-red-200 dark:bg-red-500/20',
                };
                const riskClasses = {
                    'Low': 'bg-green-600',
                    'Medium': 'bg-amber-500',
                    'High': 'bg-red-600',
                }

                mockApprovalsData.forEach(item => {
                    const daysPending = Math.round((new Date() - new Date(item.date)) / (1000 * 60 * 60 * 24));
                    const itemHtml = `
                        <div class="card p-4">
                            <div class="grid grid-cols-1 md:grid-cols-10 gap-4 items-center">
                                <div class="md:col-span-4">
                                    <p class="font-bold text-slate-800 dark:text-gray-100">${item.title}</p>
                                    <p class="text-sm text-slate-500 dark:text-gray-400">
                                        ${item.type} | Submitted by: ${item.submittedBy}
                                    </p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="font-semibold text-slate-800 dark:text-gray-100">${item.value}</p>
                                    <p class="text-sm text-slate-500 dark:text-gray-400">Submitted: ${item.date}</p>
                                </div>
                                <div class="md:col-span-2">
                                    <div class="flex items-center">
                                        <span class="w-3 h-3 rounded-full mr-2 ${riskClasses[item.risk.score]}"></span>
                                        <span class="text-sm font-medium text-slate-600 dark:text-gray-300">${item.risk.text}</span>
                                    </div>
                                    <span class="mt-1 text-xs font-semibold px-2 py-1 rounded-full ${statusClasses[item.status]}">${item.status}</span>
                                </div>
                                <div class="md:col-span-2 flex flex-col sm:flex-row gap-2">
                                     <button class="w-full text-sm font-semibold py-2 px-3 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">Approve</button>
                                     <button class="w-full text-sm font-semibold py-2 px-3 rounded-md bg-slate-200 dark:bg-gray-600 text-slate-800 dark:text-gray-200 hover:bg-slate-300">Review</button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += itemHtml;
                });
            }

            // --- NEW PROJECTS VIEW LOGIC ---
            const projectsViewContainer = document.getElementById('projects-view');
            projectsViewContainer.innerHTML = `
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">Project Monitoring</h2>
                        <p class="text-slate-500 dark:text-gray-400 mt-1">Track, filter, and review all ongoing and completed projects.</p>
                    </div>
                    <div class="flex items-center mt-4 sm:mt-0">
                        <div class="flex items-center ml-6">
                            <img src="https://placehold.co/40x40/E2E8F0/475569?text=BDO" alt="BDO" class="w-10 h-10 rounded-full">
                            <div class="ml-3">
                                <p class="font-semibold text-slate-800 dark:text-gray-100">Mr. Alok Verma</p>
                                <p class="text-sm text-slate-500 dark:text-gray-400">BDO, Pusa Block</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mb-6 p-4">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex flex-wrap gap-4 flex-grow">
                            <select id="state-select" class="flex-grow border border-slate-300 rounded-lg px-3 py-2 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">Select State</option>
                            </select>
                            <select id="district-select" class="flex-grow border border-slate-300 rounded-lg px-3 py-2 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                                <option value="">Select District</option>
                            </select>
                            <select id="project-select" class="flex-grow border border-slate-300 rounded-lg px-3 py-2 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                                <option value="">Select Project</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-4">
                            <button id="reset-filters-btn" class="bg-slate-200 text-slate-800 dark:bg-gray-600 dark:text-gray-200 font-semibold px-4 py-2 rounded-lg hover:bg-slate-300 dark:hover:bg-gray-500 flex items-center">
                                <i data-lucide="rotate-cw" class="w-5 h-5 mr-2"></i>Reset
                            </button>
                            <button class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center">
                                <i data-lucide="plus" class="w-5 h-5 mr-2"></i>Add Project
                            </button>
                        </div>
                    </div>
                </div>
                <div id="project-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            `;
            
            const stateSelect = document.getElementById('state-select');
            const districtSelect = document.getElementById('district-select');
            const projectSelect = document.getElementById('project-select');
            const projectGrid = document.getElementById('project-grid');
            const resetFiltersBtn = document.getElementById('reset-filters-btn');
            let allProjectCards = [];

            const projectData = {
                "Andhra Pradesh": { "Visakhapatnam": ["Vizag Port Expansion", "Bheemili Beach Corridor"], "Guntur": ["Guntur Chili Market Modernization", "Amaravati Road Widening"], "Tirupati": ["Tirupati Temple Infrastructure Upgrade", "Garuda Varadhi Flyover"], "Amaravati": ["Amaravati Capital City Roads", "Government Complex Construction"] },
                "Arunachal Pradesh": { "Tawang": ["Tawang Monastery Beautification", "Sela Tunnel Connectivity"], "Itanagar": ["Itanagar Smart City Initiative", "Hollongi Airport Development"], "Ziro": ["Ziro Valley Agri-Link Roads", "Tale Valley Wildlife Sanctuary Eco-Tourism"], "Pasighat": ["Pasighat Smart City Project", "Siang Riverfront Development"] },
                "Assam": { "Guwahati": ["Guwahati Riverfront Development", "AIIMS Guwahati"], "Dibrugarh": ["Dibrugarh Tea Park", "Bogibeel Bridge Connectivity"], "Jorhat": ["Jorhat Knowledge City", "Majuli Island Protection"], "Silchar": ["Silchar Multi-Modal Logistics Park", "Barak River Dredging"] },
                "Bihar": { "Patna": ["Patna Metro Project", "Patna Ring Road"], "Gaya": ["Gaya beautification Project", "Falgu River Development"], "Muzaffarpur": ["Muzaffarpur Smart City", "Bagmati River Embankment"], "Nalanda": ["Nalanda University Campus Extension", "Rajgir International Cricket Stadium"] },
                "Chhattisgarh": { "Raipur": ["Naya Raipur Green City Project", "Raipur Smart City"], "Bastar": ["Bastar Handicrafts Hub", "Jagdalpur Airport Upgrade"], "Bilaspur": ["Bilaspur Railway Connectivity", "Arpa Riverfront Development"], "Durg": ["Durg-Bhilai Industrial Corridor", "IIT Bhilai Campus"] },
                "Goa": { "North Goa": ["North Goa Coastal Road", "Mopa Airport Connectivity"], "South Goa": ["South Goa Eco-Tourism Project", "Margao City Development"] },
                "Gujarat": { "Ahmedabad": ["Ahmedabad Smart City Phase 2", "Sabarmati Riverfront Phase 2"], "Surat": ["Surat Diamond Bourse Connectivity", "Tapi Riverfront"], "Vadodara": ["Vadodara High-Speed Rail Terminal", "Statue of Unity Connectivity"], "Rajkot": ["Rajkot AIIMS Development", "Rajkot International Airport"] },
                "Haryana": { "Gurugram": ["Gurugram Water Supply Upgrade", "Dwarka Expressway"], "Faridabad": ["Faridabad Industrial Area Revamp", "FNG Expressway"], "Panipat": ["Panipat Industrial Township", "Elevated Corridor Project"], "Ambala": ["Ambala Science City", "Ring Road Project"] },
                "Himachal Pradesh": { "Shimla": ["Shimla Ropeway Project", "Circular Road Tunnel"], "Kullu": ["Kullu Valley Wellness Centers", "Bhuntar Airport Expansion"], "Dharamshala": ["Dharamshala Smart City", "Chamunda Ropeway"], "Manali": ["Atal Tunnel Connectivity Roads", "Rohtang Tunnel Beautification"] },
                "Jharkhand": { "Ranchi": ["Ranchi Ring Road Completion", "Ranchi Smart City"], "Jamshedpur": ["Jamshedpur Steel Plant Modernization", "Domuhani Riverfront"], "Dhanbad": ["Dhanbad Coal Corridor", "IIT (ISM) Dhanbad Expansion"], "Bokaro Steel City": ["Bokaro Industrial Park", "Garga Dam Modernization"] },
                "Karnataka": { "Bengaluru": ["Bengaluru Suburban Rail Project", "Peripheral Ring Road"], "Mysuru": ["Mysuru Palace Restoration", "Mysuru-Bengaluru Expressway"], "Mangaluru": ["Mangaluru Port Expansion", "Coastal Berth Project"], "Hubballi": ["Hubballi-Dharwad Smart City", "IIT Dharwad Campus"] },
                "Kerala": { "Kochi": ["Kochi Water Metro Expansion", "Infopark Phase 2"], "Thiruvananthapuram": ["Technopark Phase IV Development", "Vizhinjam Port Project"], "Kozhikode": ["Kozhikode Beachfront Project", "Cyberpark Expansion"], "Thrissur": ["Thrissur Pooram Infrastructure", "Kochi-Thrissur Highway Widening"] },
                "Madhya Pradesh": { "Bhopal": ["Bhopal Lake Conservation", "Bhopal Metro Project"], "Indore": ["Indore Waste Management Plant", "Indore Smart City"], "Gwalior": ["Gwalior Heritage Restoration", "Elevated Road Project"], "Jabalpur": ["Jabalpur Smart City", "Narmada Riverfront"] },
                "Maharashtra": { "Mumbai": ["Mumbai Coastal Road Project", "Navi Mumbai International Airport"], "Pune": ["Pune Metro Line 3", "Pune Ring Road"], "Nagpur": ["Nagpur Samruddhi Mahamarg Connectivity", "MIHAN Cargo Hub"], "Nashik": ["Nashik Wine Tourism Circuit", "Neo Metro Project"] },
                "Manipur": { "Imphal": ["Imphal Smart City Mission", "Loktak Lake Rejuvenation"], "Churachandpur": ["Churachandpur Medical College", "Tipaimukh Dam Project"], "Ukhrul": ["Ukhrul Eco-Tourism Project", "Hill Roads Improvement"], "Thoubal": ["Thoubal Dam Project", "Thoubal Sports Complex"] },
                "Meghalaya": { "Shillong": ["Shillong IT Park", "Shillong Smart City"], "Cherrapunji": ["Cherrapunji Eco-Resort Development", "Mawmluh Cave Tourism"], "Tura": ["Tura Medical College", "Nongstoin-Tura Highway"], "Jowai": ["Jowai Glass Bridge Project", "Myntdu River Development"] },
                "Mizoram": { "Aizawl": ["Aizawl Sports Complex", "Aizawl Smart City"], "Lunglei": ["Lunglei Border Haat", "Kaladan Multi-Modal Project"], "Champhai": ["Champhai Grape Winery", "Zokhawthar Border Trade Centre"], "Kolasib": ["Kolasib Rail Connectivity", "Tuirial Dam"] },
                "Nagaland": { "Kohima": ["Kohima Smart City Plan", "Chiethu Airport"], "Dimapur": ["Dimapur Airport Upgrade", "4-Lane Highway Project"], "Mokokchung": ["Mokokchung Cultural Hub", "Dikhu River Project"], "Wokha": ["Doyang River Project", "Wokha-Bhandari Road"] },
                "Odisha": { "Bhubaneswar": ["Bhubaneswar Temple City Heritage Project", "Smart City Phase 2"], "Puri": ["Puri Beachfront Development", "Jagannath Temple Corridor"], "Cuttack": ["Cuttack Riverfront Development", "SCB Medical College Expansion"], "Rourkela": ["Rourkela Steel Plant Modernization", "Biju Patnaik University Campus"] },
                "Punjab": { "Amritsar": ["Amritsar Heritage Village Project", "Golden Temple Corridor"], "Ludhiana": ["Ludhiana Industrial Hub", "Budha Nullah Rejuvenation"], "Jalandhar": ["Jalandhar Sports Hub", "Smart City Mission"], "Patiala": ["Patiala Heritage Restoration", "Canal Front Development"] },
                "Rajasthan": { "Jaipur": ["Jaipur Walled City Restoration", "Dravyavati River Project"], "Jodhpur": ["Jodhpur Water Canal Project", "Elevated Road"], "Udaipur": ["Udaipur Lake Conservation", "Smart City Project"], "Kota": ["Kota Coaching Hub Infrastructure", "Chambal Riverfront"] },
                "Sikkim": { "Gangtok": ["Gangtok Cable Car Network", "Smart City Development"], "Namchi": ["Namchi Cultural Centre", "Siddheshwar Dham Complex"], "Gyalshing": ["Pelling Skywalk Project", "Singshore Bridge Expansion"], "Mangan": ["Mangan Eco-Tourism", "Teesta River Hydropower"] },
                "Tamil Nadu": { "Chennai": ["Chennai Metro Phase II", "Koyambedu Grade Separator"], "Coimbatore": ["Coimbatore Defence Corridor", "Smart City Mission"], "Madurai": ["Madurai AIIMS Project", "Vaigai Riverfront"], "Tiruchirappalli": ["Trichy Airport Expansion", "Cauvery Bridge Widening"] },
                "Telangana": { "Hyderabad": ["Hyderabad Pharma City", "Regional Ring Road"], "Warangal": ["Warangal Textile Park", "Kakatiya Mega Textile Park"], "Nizamabad": ["Nizamabad IT Hub", "Sri Ram Sagar Project"], "Karimnagar": ["Karimnagar Cable Bridge", "Manair Riverfront"] },
                "Tripura": { "Agartala": ["Agartala-Akhaura Rail Link", "Smart City Mission"], "Udaipur": ["Udaipur Tourism Circuit", "Matabari Temple Complex"], "Dharmanagar": ["Dharmanagar Industrial Park", "Juri River Project"], "Belonia": ["Belonia Border Infrastructure", "Feni Bridge"] },
                "Uttar Pradesh": { "Lucknow": ["Lucknow Smart City", "Gomti Riverfront Phase 2"], "Agra": ["Taj Corridor Project", "Agra Metro"], "Varanasi": ["Kashi Vishwanath Corridor Expansion", "Ring Road Phase 2"], "Kanpur": ["Kanpur Metro Project", "Leather Park Development"], "Prayagraj": ["Prayagraj Kumbh Mela Infrastructure", "Civil Airport Expansion"] },
                "Uttarakhand": { "Dehradun": ["Dehradun-Mussoorie Ropeway", "Smart City Project"], "Haridwar": ["Har-ki-Pauri Redevelopment", "Delhi-Haridwar Expressway"], "Nainital": ["Nainital Lake Rejuvenation", "Bypass Road Project"], "Rishikesh": ["Rishikesh Yoga Capital Infrastructure", "Janki Setu Bridge"] },
                "West Bengal": { "Kolkata": ["Kolkata East-West Metro", "New Town Financial Hub"], "Darjeeling": ["Darjeeling Himalayan Railway Upgrade", "Hill Town Beautification"], "Siliguri": ["Siliguri Smart City", "Mahananda Riverfront"], "Howrah": ["Howrah Industrial Park", "Ganga Riverfront"] },
                "Delhi": { "North Delhi": ["North Delhi Infra Grant", "Chandni Chowk Redevelopment"], "West Delhi": ["West Delhi Skill Center", "Bharat Vandana Park"], "East Delhi": ["East Delhi Adarsh Gram", "Anand Vihar Transport Hub"] }
            };

            function createProjectCardHTML(state, district, project) {
                const statuses = ['Completed', 'In Progress', 'Delayed', 'Initiated'];
                const statusColors = {'Completed': 'green', 'In Progress': 'yellow', 'Delayed': 'red', 'Initiated': 'blue'};
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const randomProgress = randomStatus === 'Completed' ? 100 : Math.floor(Math.random() * 90) + 10;
                const totalBudget = (Math.random() * 500 + 50).toFixed(0);
                const utilizedBudget = ((totalBudget * randomProgress) / 100).toFixed(0);
                const feedbackCount = Math.floor(Math.random() * 200);
                const agencies = ['State PWD', 'Central Govt.', 'Local Panchayat', 'Contractor Co.', 'Infra Corp.'];
                const randomAgency = agencies[Math.floor(Math.random() * agencies.length)];
                const color = statusColors[randomStatus];

                return `
                <div class="card p-5 flex flex-col project-card" data-state="${state}" data-district="${district}" data-project="${project}">
                    <div>
                        <div class="flex justify-between items-start">
                            <h4 class="font-semibold text-slate-800 dark:text-gray-100">${project}</h4>
                            <span class="bg-${color}-100 text-${color}-800 dark:bg-${color}-500/10 dark:text-${color}-400 text-xs font-medium px-2.5 py-0.5 rounded-full">${randomStatus}</span>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Agency: ${randomAgency}</p>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-medium text-slate-600 dark:text-gray-300">Progress</span>
                            <span class="text-sm font-bold text-${color}-600 dark:text-${color}-400">${randomProgress}%</span>
                        </div>
                        <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2.5">
                            <div class="bg-${color}-500 h-2.5 rounded-full" style="width: ${randomProgress}%;"></div>
                        </div>
                    </div>
                    <div class="mt-4 border-t border-slate-200 dark:border-gray-700 pt-4">
                        <p class="text-sm text-slate-600 dark:text-gray-300">Budget: <span class="font-bold text-slate-800 dark:text-gray-100">₹${utilizedBudget}Cr</span> / ₹${totalBudget}Cr Utilized</p>
                    </div>
                    <div class="mt-auto pt-4">
                        <button class="view-feedback-btn w-full text-center py-2 px-4 bg-indigo-50 dark:bg-gray-700 text-indigo-700 dark:text-gray-200 rounded-lg text-sm font-semibold hover:bg-indigo-100 dark:hover:bg-gray-600">
                            View Public Feedback (${feedbackCount})
                        </button>
                    </div>
                </div>`;
            }

            function populateProjectCards() {
                let allCardsHTML = '';
                for (const state in projectData) {
                    for (const district in projectData[state]) {
                        projectData[state][district].forEach(project => {
                            allCardsHTML += createProjectCardHTML(state, district, project);
                        });
                    }
                }
                projectGrid.innerHTML = allCardsHTML;
                allProjectCards = document.querySelectorAll('.project-card');
                rebindFeedbackButtons();
            }
            
            Object.keys(projectData).sort().forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });

            stateSelect.addEventListener('change', () => {
                const selectedState = stateSelect.value;
                districtSelect.innerHTML = '<option value="">Select District</option>';
                projectSelect.innerHTML = '<option value="">Select Project</option>';
                districtSelect.disabled = true; projectSelect.disabled = true;
                if (selectedState) {
                    districtSelect.disabled = false;
                    Object.keys(projectData[selectedState]).sort().forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                }
                applyFilters();
            });

            districtSelect.addEventListener('change', () => {
                const selectedState = stateSelect.value;
                const selectedDistrict = districtSelect.value;
                projectSelect.innerHTML = '<option value="">Select Project</option>';
                projectSelect.disabled = true;
                if (selectedDistrict) {
                    projectSelect.disabled = false;
                    projectData[selectedState][selectedDistrict].sort().forEach(project => {
                        const option = document.createElement('option');
                        option.value = project;
                        option.textContent = project;
                        projectSelect.appendChild(option);
                    });
                }
                applyFilters();
            });

            projectSelect.addEventListener('change', applyFilters);

            function applyFilters() {
                const selectedState = stateSelect.value;
                const selectedDistrict = districtSelect.value;
                const selectedProject = projectSelect.value;
                allProjectCards.forEach(card => {
                    const stateMatch = !selectedState || card.dataset.state === selectedState;
                    const districtMatch = !selectedDistrict || card.dataset.district === selectedDistrict;
                    const projectMatch = !selectedProject || card.dataset.project === selectedProject;
                    card.style.display = (stateMatch && districtMatch && projectMatch) ? 'flex' : 'none';
                });
            }

            resetFiltersBtn.addEventListener('click', () => {
                stateSelect.value = "";
                districtSelect.innerHTML = '<option value="">Select District</option>';
                projectSelect.innerHTML = '<option value="">Select Project</option>';
                districtSelect.disabled = true; projectSelect.disabled = true;
                applyFilters();
            });

            const feedbackModal = document.getElementById('feedback-modal');
            const closeFeedbackModalBtn = document.getElementById('close-feedback-modal-btn');
            const feedbackModalSubtitle = document.getElementById('feedback-modal-subtitle');

            const openFeedbackModal = (e) => {
                const card = e.currentTarget.closest('.project-card');
                const projectName = card.dataset.project;
                feedbackModalSubtitle.textContent = `Project: ${projectName}`;
                feedbackModal.classList.remove('hidden');
                lucide.createIcons();
            };

            const closeFeedbackModal = () => {
                feedbackModal.classList.add('hidden');
            };

            function rebindFeedbackButtons() {
                const viewFeedbackBtns = document.querySelectorAll('.view-feedback-btn');
                viewFeedbackBtns.forEach(btn => btn.addEventListener('click', openFeedbackModal));
            }

            closeFeedbackModalBtn.addEventListener('click', closeFeedbackModal);
            feedbackModal.addEventListener('click', (event) => {
                if (event.target === feedbackModal) closeFeedbackModal();
            });

            // --- FINAL INITIALIZATION ---
            populateProjectCards(); // Populate the new project grid
            updateStateView('Maharashtra');
            updateApprovalsView();
            showView('national');
        });
    </script>
</body>
</html>
