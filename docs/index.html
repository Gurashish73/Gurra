<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARPAN-AJAY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* High Contrast Dark Mode Styles */
        .dark body {
            background-color: #000000;
            color: #ffffff;
        }
        .dark #main-header-el, .dark #mobile-menu, .dark #advanced-search-modal .bg-white, .dark .bg-white, .dark footer, .dark #local-snapshot-modal .bg-white {
             background-color: #000000 !important;
             box-shadow: 0 2px 4px rgba(255,255,255,0.1);
        }
        .dark .text-gray-600, .dark .text-gray-500, .dark .text-gray-700, .dark .text-gray-400 { color: #ffffff; }
        .dark .text-blue-700, .dark .text-blue-600, .dark a, .dark .text-blue-700, .dark .transparency-tools a { color: #FCFF00; }
        .dark .main-nav-container { border-color: #FCFF00; }
        .dark .main-nav-link { color: #FCFF00; }
        .dark .main-nav-link.active, .dark .main-nav-link:hover { background-color: #FCFF00; color: #000000; }
        .dark .text-gray-800 { color: #ffffff; }
        .dark .border-blue-600 { border-color: #FCFF00; }
        .dark .section-title { color: #FCFF00; }
        .dark .section-title::after { background-color: #FCFF00; }
        .dark .hero-section { filter: grayscale(100%); }
        .dark .hero-section::before {
             background-image: linear-gradient(to bottom, #000, rgba(0, 0, 0, 0));
        }
        .dark .search-bar-container {
            background-color: #000;
            border: 2px solid #FCFF00;
        }
        .dark .search-bar-container input::placeholder { color: #ccc; }
        .dark .search-bar-container input, .dark .search-bar-container button {
             color: #ffffff;
             background-color: transparent;
        }
        .dark .search-bar-container i { color: #FCFF00; }
        .dark .bg-gray-100, .dark .bg-gray-50 {
            background-color: #111;
            border: 1px solid #444;
        }
        .dark .transparency-tools li {
             background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24" fill="none" stroke="%23FCFF00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>');
        }
        .dark #mid-section-btn {
            background-color: #FCFF00 !important;
            color: #000 !important;
            border-color: #FCFF00 !important;
        }
        .dark a.bg-blue-600, .dark button.bg-blue-600 {
             background-color: #FCFF00 !important;
             color: #000 !important;
        }
        .dark #lang-dropdown, .dark #social-dropdown {
            background-color: #111;
            border: 1px solid #444;
        }
        .dark #lang-dropdown a:hover, .dark #social-dropdown a:hover {
            background-color: #333;
        }


        .main-nav-container {
            border: 2px solid #0d6efd;
            border-radius: 9999px;
            padding: 0.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            transition: border-color 0.3s ease;
        }

        .main-nav-link {
            transition: all 0.3s ease;
            color: #0d6efd;
        }

        .main-nav-link.active, .main-nav-link:hover {
            background-color: #0d6efd;
            color: white;
        }

        .hero-section {
            background-image: url('/images/banner-inner-1.jpg');
            background-size: cover;
            background-position: center;
            height: 400px;
            padding-top: 60px; 
            padding-bottom: 60px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 150px;
            background-image: linear-gradient(to bottom, white, rgba(255, 255, 255, 0));
        }
        
        .search-bar-container {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            position: relative;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            color: #0d6efd;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: #0d6efd;
        }
        .transparency-tools li {
            background: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24" fill="none" stroke="%230d6efd" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>') no-repeat left center;
            background-size: 16px;
            padding-left: 25px;
            margin-bottom: 0.75rem;
        }
        
        #main-header-el {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body class="bg-white">

    <!-- Main Header & Navigation --><header id="main-header-el" class="main-header transition-all duration-300 ease-in-out">
        <!-- Top bar content --><div class="container mx-auto px-4">
            <div class="py-1 flex justify-end items-center space-x-2">
                <a href="#" class="rounded-full h-8 w-8 flex items-center justify-center text-sm transition text-gray-600 hover:bg-gray-200" title="Sitemap">
                    <i class="fas fa-sitemap"></i>
                </a>
                 <a href="#" class="rounded-full h-8 w-8 flex items-center justify-center text-sm transition text-gray-600 hover:bg-gray-200" title="Screen Reader">
                     <i class="fa-solid fa-person-circle-question"></i>
                </a>
                <!-- Language Selector -->
                <div class="relative">
                    <button id="lang-toggle" class="flex items-center rounded-full px-3 py-1 text-sm text-gray-600 hover:bg-gray-200">
                        <i class="fas fa-globe mr-1"></i> English <i class="fas fa-caret-down ml-1"></i>
                    </button>
                    <div id="lang-dropdown" class="absolute hidden right-0 mt-2 w-32 bg-white rounded-md shadow-lg z-20">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">English</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">हिन्दी</a>
                    </div>
                </div>
                <div class="flex items-center border rounded-full bg-transparent">
                     <button id="font-decrease" class="px-3 py-1 text-xs text-gray-600">A-</button>
                     <button id="font-reset" class="px-3 py-1 text-sm border-l border-r border-gray-300 text-gray-600">A</button>
                     <button id="font-increase" class="px-3 py-1 text-base text-gray-600">A+</button>
                </div>
                 <div class="flex items-center">
                     <button id="theme-dark" class="w-6 h-6 bg-black border-2 border-gray-400 rounded-full"></button>
                     <button id="theme-light" class="w-6 h-6 bg-white border-2 border-gray-400 rounded-full ml-1"></button>
                 </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-3 flex flex-wrap justify-between items-center">
            <div class="flex items-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/80px-Emblem_of_India.svg.png" alt="Emblem of India" class="h-12 mr-4">
                <div class="ml-2 sm:ml-4">
                    <h1 class="text-lg sm:text-2xl font-bold text-blue-700">DARPAN-AJAY</h1>
                    <p class="text-xs sm:text-sm text-gray-500 hidden sm:block max-w-xs">A Real-Time Accountability Platform for the PM-AJAY Scheme.</p>
                </div>
            </div>
            <div class="hidden md:flex items-center space-x-4 w-full md:w-auto justify-end mt-2 md:mt-0">
                <nav>
                    <div class="main-nav-container">
                        <a href="#" class="main-nav-link active font-semibold py-1 px-4 rounded-full text-xs">HOME</a>
                        <a href="#" class="main-nav-link font-semibold py-1 px-4 rounded-full text-xs">PERFORMANCE RANKINGS</a>
                        <a href="#" class="main-nav-link font-semibold py-1 px-4 rounded-full text-xs">LODGE A GRIEVANCE</a>
                        <a href="#" class="main-nav-link font-semibold py-1 px-4 rounded-full text-xs">ABOUT THE SCHEME</a>
                    </div>
                </nav>
                <a href="#" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-full text-sm hover:bg-blue-700 transition">Login / Signup</a>
            </div>
            <!-- Mobile Menu Button --><div class="md:hidden">
                <button id="mobile-menu-button" class="focus:outline-none text-gray-600">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu --><div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-sm shadow-md">
            <nav class="flex flex-col items-center space-y-2 p-4">
                 <a href="#" class="mobile-nav-link active font-semibold py-2 px-5 rounded-full w-full text-center text-xs">HOME</a>
                 <a href="#" class="mobile-nav-link font-semibold py-2 px-5 rounded-full w-full text-center text-xs">PERFORMANCE RANKINGS</a>
                 <a href="#" class="mobile-nav-link font-semibold py-2 px-5 rounded-full w-full text-center text-xs">LODGE A GRIEVANCE</a>
                 <a href="#" class="mobile-nav-link font-semibold py-2 px-5 rounded-full w-full text-center text-xs">ABOUT THE SCHEME</a>
                <div class="pt-4 w-full">
                    <a href="#" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-full text-sm hover:bg-blue-700 transition w-full block text-center">Login / Signup</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section --><section class="hero-section">
        <div class="relative w-full max-w-3xl px-4 z-10">
            <div class="search-bar-container p-2 flex items-center rounded-full">
                <input type="text" placeholder="Enter your State, District, or Village name..." class="w-full bg-transparent border-none focus:ring-0 text-base sm:text-lg px-4 py-2">
                <button class="bg-white p-2 rounded-full">
                    <i class="fas fa-search text-gray-500 text-xl"></i>
                </button>
            </div>
            <div class="text-right mt-2">
                <button id="advanced-search-btn" class="text-white text-sm font-semibold hover:underline bg-transparent px-2 py-1 rounded-lg">
                    <i class="fas fa-cog mr-1"></i> Advanced Search
                </button>
            </div>
        </div>
    </section>

    <!-- Mid-Section Button --><div class="container mx-auto text-center px-4 relative z-10 -mt-7">
        <button id="mid-section-btn" class="bg-white border-2 border-blue-600 text-blue-600 font-bold py-2 px-6 rounded-full hover:bg-blue-50 transition w-full sm:w-auto shadow-md">
            VIEW NATIONAL PROJECT MAP <i class="fas fa-map-marked-alt ml-2"></i>
        </button>
    </div>

    <!-- Main Content Area --><main class="container mx-auto p-4 sm:p-8 pt-12 bg-white">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
            <!-- Left Column: National Stats -->
            <div class="md:col-span-2">
                <h2 class="text-2xl section-title">NATIONAL LIVE STATUS</h2>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="villages-covered-stat" class="text-3xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Villages Covered</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="beneficiaries-impacted-stat" class="text-3xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Beneficiaries Impacted</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="funds-sanctioned-stat" class="text-3xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Funds Sanctioned</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="works-completed-stat" class="text-3xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Works Completed</p>
                    </div>
                </div>
                <p class="mt-6 text-center text-gray-700 italic">"Real-time data ensuring every rupee is tracked and every project is visible."</p>
            </div>

            <!-- Right Column: Transparency Tools -->
            <div>
                <h2 class="text-2xl section-title">TRANSPARENCY TOOLS</h2>
                <ul class="transparency-tools">
                    <li><a href="#" class="hover:underline">Follow the Money</a></li>
                    <li><a href="#" class="hover:underline">Live Visual Reports</a></li>
                    <li><a href="#" class="hover:underline">Agency Accountability</a></li>
                    <li><a href="#" id="local-snapshot-link" class="hover:underline">Get Your Local Snapshot</a></li>
                    <li><a href="#" class="hover:underline">View Social Audit Calendar</a></li>
                    <li><a href="#" class="hover:underline">Subscribe for SMS/Voice Alerts</a></li>
                </ul>
            </div>
        </div>
    </main>
    
    <!-- National Scorecard Section -->
    <section class="bg-gray-50 py-12">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-8">National Scorecard: Key Performance Indicators</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Card 1: Fund Utilization Funnel -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold mb-4 text-center">Fund Utilization Funnel</h3>
                    <canvas id="funnelChart"></canvas>
                </div>
                <!-- Card 2: Component-wise Allocation -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold mb-4 text-center">Component-wise Allocation</h3>
                    <canvas id="donutChart"></canvas>
                </div>
                <!-- Card 3: Project Completion Rate -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold mb-4 text-center">Project Completion Rate (Trend)</h3>
                    <canvas id="lineChart"></canvas>
                </div>
                <!-- Card 4: Top 5 Project Types -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold mb-4 text-center">Top 5 Project Types</h3>
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- Accountability Engine Section -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-2">Driving Performance Through Transparency</h2>
            <p class="text-center text-gray-600 mb-8">The Performance Leaderboard</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Top 5 -->
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-green-600">Top 5 Performing States</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white rounded-lg shadow">
                            <thead>
                                <tr class="w-full bg-gray-100 text-left">
                                    <th class="p-3">State Name</th>
                                    <th class="p-3 text-center">Projects Completed (%)</th>
                                    <th class="p-3 text-center">Fund Utilization (%)</th>
                                </tr>
                            </thead>
                            <tbody id="top-5-table-body">
                                <!-- Rows will be inserted by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Bottom 5 -->
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-red-600">Bottom 5 Performing States</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white rounded-lg shadow">
                             <thead>
                                <tr class="w-full bg-gray-100 text-left">
                                    <th class="p-3">State Name</th>
                                    <th class="p-3 text-center">Projects Completed (%)</th>
                                    <th class="p-3 text-center">Fund Utilization (%)</th>
                                </tr>
                            </thead>
                            <tbody id="bottom-5-table-body">
                               <!-- Rows will be inserted by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center md:text-left">
                <div class="md:col-span-2">
                     <h4 class="font-bold mb-4">DARPAN-AJAY</h4>
                     <p class="text-sm text-gray-400">A Real-Time Accountability Platform for the PM-AJAY Scheme by the Ministry of Social Justice & Empowerment.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Quick Links</h4>
                    <ul class="text-sm space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">About PM-AJAY</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQs</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Data Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                     <h4 class="font-bold mb-4">Supported By</h4>
                     <div class="flex justify-center md:justify-start space-x-4 items-center h-10">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/Digital_India_logo.svg" alt="Digital India Logo" class="h-full opacity-80 hover:opacity-100">
                        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/44/Ministry_of_Social_Justice_and_Empowerment_logo.svg/220px-Ministry_of_Social_Justice_and_Empowerment_logo.svg.png" alt="Ministry Logo" class="h-full bg-white p-1 rounded-sm opacity-80 hover:opacity-100">
                     </div>
                </div>
            </div>
            <div class="text-center text-gray-500 mt-8 pt-4 border-t border-gray-700">
                <p class="text-xs">This portal is a prototype developed for the Smart India Hackathon 2025.</p>
            </div>
        </div>
    </footer>


    <!-- Advanced Search Modal -->
    <div id="advanced-search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md m-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Advanced Search Filters</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="project-type" class="block text-sm font-medium text-gray-700">Project Type</label>
                    <select id="project-type" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option>All</option>
                        <option>Infrastructure Development</option>
                        <option>Skill Development</option>
                        <option>Hostel Construction</option>
                    </select>
                </div>
                <div>
                    <label for="financial-year" class="block text-sm font-medium text-gray-700">Financial Year</label>
                    <select id="financial-year" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option>2024-2025</option>
                        <option>2023-2024</option>
                        <option>2022-2023</option>
                    </select>
                </div>
                <div>
                    <label for="implementing-agency" class="block text-sm font-medium text-gray-700">Implementing Agency</label>
                    <input type="text" id="implementing-agency" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div class="text-right">
                    <button class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-full text-sm hover:bg-blue-700 transition">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Local Snapshot Modal -->
    <div id="local-snapshot-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg m-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Your Local Snapshot</h3>
                <button id="close-snapshot-modal-btn" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="location-input" class="block text-sm font-medium text-gray-700">Enter Your District Name</label>
                    <div class="mt-1 flex rounded-md shadow-sm">
                        <input type="text" id="location-input" class="flex-1 block w-full border border-gray-300 rounded-l-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="e.g., New Delhi">
                        <button id="get-snapshot-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-r-md text-white bg-blue-600 hover:bg-blue-700">
                            Get Snapshot
                        </button>
                    </div>
                </div>
                <div id="snapshot-results" class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center pt-4">
                     <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="modal-projects-stat" class="text-2xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Projects Underway</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="modal-funds-stat" class="text-2xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Funds Utilized</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 id="modal-grievances-stat" class="text-2xl font-bold text-blue-600">--</h3>
                        <p class="text-sm text-gray-600">Grievances Resolved</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- UI ELEMENT REFERENCES ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const langToggle = document.getElementById('lang-toggle');
            const langDropdown = document.getElementById('lang-dropdown');
            // Advanced Search Modal
            const advancedSearchBtn = document.getElementById('advanced-search-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modal = document.getElementById('advanced-search-modal');
            // Local Snapshot Modal
            const localSnapshotLink = document.getElementById('local-snapshot-link');
            const localSnapshotModal = document.getElementById('local-snapshot-modal');
            const closeSnapshotModalBtn = document.getElementById('close-snapshot-modal-btn');
            const locationInput = document.getElementById('location-input');
            const getSnapshotBtn = document.getElementById('get-snapshot-btn');


            // --- ACCESSIBILITY FEATURES ---
            const fontDecrease = document.getElementById('font-decrease');
            const fontReset = document.getElementById('font-reset');
            const fontIncrease = document.getElementById('font-increase');
            const themeDark = document.getElementById('theme-dark');
            const themeLight = document.getElementById('theme-light');
            const htmlEl = document.documentElement;

            fontDecrease.addEventListener('click', () => { document.body.style.fontSize = '0.875rem'; });
            fontReset.addEventListener('click', () => { document.body.style.fontSize = '1rem'; });
            fontIncrease.addEventListener('click', () => { document.body.style.fontSize = '1.125rem'; });
            themeDark.addEventListener('click', () => { htmlEl.classList.add('dark'); });
            themeLight.addEventListener('click', () => { htmlEl.classList.remove('dark'); });

            // --- UI EVENT LISTENERS ---
            if (mobileMenuButton) mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            if (langToggle) langToggle.addEventListener('click', (e) => { e.stopPropagation(); langDropdown.classList.toggle('hidden'); });
            
            // Advanced Search Modal Logic
            if(advancedSearchBtn && modal && closeModalBtn) {
                advancedSearchBtn.addEventListener('click', () => modal.classList.replace('hidden', 'flex'));
                closeModalBtn.addEventListener('click', () => modal.classList.replace('flex', 'hidden'));
                modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.replace('flex', 'hidden'); });
            }
            
            // Local Snapshot Modal Logic
            if(localSnapshotLink && localSnapshotModal && closeSnapshotModalBtn && getSnapshotBtn) {
                localSnapshotLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    localSnapshotModal.classList.replace('hidden', 'flex');
                });
                closeSnapshotModalBtn.addEventListener('click', () => localSnapshotModal.classList.replace('flex', 'hidden'));
                localSnapshotModal.addEventListener('click', (e) => { if(e.target === localSnapshotModal) localSnapshotModal.classList.replace('flex', 'hidden'); });
                
                getSnapshotBtn.addEventListener('click', () => {
                    const district = locationInput.value.trim();
                    if (district) {
                        fetchLocalData(district);
                    } else {
                        alert("Please enter a district name.");
                    }
                });
            }

            document.addEventListener('click', (event) => {
                if (langDropdown && !langDropdown.classList.contains('hidden') && !langDropdown.contains(event.target) && !langToggle.contains(event.target)) {
                    langDropdown.classList.add('hidden');
                }
            });

            // --- CHART.JS INITIALIZATION ---
            let charts = {};

            const initCharts = () => {
                const chartIds = ['funnelChart', 'donutChart', 'lineChart', 'barChart'];
                chartIds.forEach(id => {
                    const canvas = document.getElementById(id);
                    if (canvas) {
                         const ctx = canvas.getContext('2d');
                         if (charts[id]) charts[id].destroy();
                         let type, options;
                         switch(id) {
                            case 'funnelChart': type = 'bar'; options = { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }; break;
                            case 'donutChart': type = 'doughnut'; options = { responsive: true, plugins: { legend: { position: 'top' } } }; break;
                            case 'lineChart': type = 'line'; options = { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }; break;
                            case 'barChart': type = 'bar'; options = { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }; break;
                         }
                         charts[id] = new Chart(ctx, { type, data: {}, options });
                    }
                });
            }
            
            initCharts();
            
            // --- DATA FETCHING AND UPDATING ---

            // --- MOCK DATA (FALLBACK) ---
            const MOCK_DATA = {
                nationalStats: { villagesCovered: 47511, beneficiariesImpacted: 4587553, fundsSanctioned: 109607, worksCompleted: 41496 },
                funnelChart: [109607, 95200, 75600, 68900],
                donutChart: { labels: ['Adarsh Gram', 'Grants-in-Aid', 'Hostels', 'Admin & M&E'], data: [50, 43, 2, 5] },
                lineChart: [65, 70, 72, 78, 85],
                barChart: [12000, 9500, 8200, 7100, 6500],
                leaderboards: {
                    top5: [{ state: "Andhra Pradesh", projects: 98, funds: 95 },{ state: "Gujarat", projects: 95, funds: 92 },{ state: "Karnataka", projects: 92, funds: 88 },{ state: "Tamil Nadu", projects: 91, funds: 85 },{ state: "Maharashtra", projects: 89, funds: 84 }],
                    bottom5: [{ state: "Bihar", projects: 45, funds: 50 },{ state: "Jharkhand", projects: 48, funds: 52 },{ state: "Assam", projects: 51, funds: 55 },{ state: "Odisha", projects: 55, funds: 58 },{ state: "West Bengal", projects: 58, funds: 62 }]
                }
            };
            
            // --- DATA FETCHING FUNCTIONS (MODULAR) ---

            const fetchNationalStats = async () => {
                // Add your API Key and Resource ID for National Stats here
                // const apiKey = '...';
                // For now, using mock data
                return MOCK_DATA.nationalStats;
            };

            const fetchFunnelChartData = async () => {
                // Add your API Key and Resource ID for Funnel Chart here
                return MOCK_DATA.funnelChart;
            };

            const fetchDonutChartData = async () => {
                const apiKey = '579b464db66ec23bdd00000133fb7135101845b740c2380f4cccd1d5';
                const resourceId = '95b4bfc1-3802-4a47-9269-df1b9a242c74'; // Example: PMAGY data
                const apiUrl = `https://api.data.gov.in/resource/${resourceId}?api-key=${apiKey}&format=json&limit=10`;
                
                if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
                    console.log("Donut Chart: API Key not provided. Using mock data.");
                    return MOCK_DATA.donutChart;
                }

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`API Error: ${response.status}`);
                    const rawData = await response.json();
                    
                    // Simple processing: Summing up financial progress for different components
                    const componentData = { 'Adarsh Gram': 0, 'Grants-in-Aid': 0, 'Hostels': 0, 'Admin & M&E': 0 };
                    rawData.records.forEach(rec => {
                        componentData['Adarsh Gram'] += parseFloat(rec.component_1_fin_cum) || 0;
                        componentData['Grants-in-Aid'] += parseFloat(rec.component_2_fin_cum) || 0;
                        componentData['Hostels'] += parseFloat(rec.component_3_fin_cum) || 0;
                        componentData['Admin & M&E'] += parseFloat(rec.component_4_fin_cum) || 0;
                    });

                    console.log("Donut Chart: Successfully fetched and processed real data.");
                    return {
                        labels: Object.keys(componentData),
                        data: Object.values(componentData)
                    };
                } catch (error) {
                    console.error("Donut Chart: Failed to fetch real data. Using mock data.", error);
                    return MOCK_DATA.donutChart;
                }
            };
            
            const fetchLineChartData = async () => {
                 return MOCK_DATA.lineChart;
            }
            
             const fetchBarChartData = async () => {
                 return MOCK_DATA.barChart;
            }
            
             const fetchLeaderboardData = async () => {
                 return MOCK_DATA.leaderboards;
            }


            const fetchLocalData = async (district) => {
                document.getElementById('modal-projects-stat').textContent = '...';
                document.getElementById('modal-funds-stat').textContent = '...';
                document.getElementById('modal-grievances-stat').textContent = '...';
                
                const geminiApiKey = "AIzaSyDzX6NrBh-02my-Sll8stjoUYffBkgVB4Y"; // IMPORTANT: Add your Gemini API Key here
                if (!geminiApiKey) {
                    console.log("Gemini API key not provided. Using mock local data.");
                    updateLocalSnapshotWidget({ projectsUnderway: 15, fundsUtilized: "₹2.5 Cr", grievancesResolved: "89%" });
                    return;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${geminiApiKey}`;
                const prompt = `Find publicly available data for the PM-AJAY scheme in ${district} district. Provide the number of projects underway, the total funds utilized in crores, and the grievance resolution percentage. Format the response as a simple JSON object with keys: "projectsUnderway", "fundsUtilized", and "grievancesResolved" (e.g., "₹2.5 Cr", "89%").`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], tools: [{ "google_search": {} }] })
                    });
                    if (!response.ok) throw new Error(`Gemini API call failed: ${response.status}`);
                    
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text.replace(/```json|```/g, '').trim();
                    if(text) {
                        const localData = JSON.parse(text);
                        updateLocalSnapshotWidget(localData);
                    } else { throw new Error("Invalid response from Gemini API"); }
                } catch (error) {
                    console.error("Error fetching local data:", error);
                    updateLocalSnapshotWidget({ projectsUnderway: 'N/A', fundsUtilized: 'N/A', grievancesResolved: 'N/A' });
                }
            };
            
            // --- UI UPDATE FUNCTIONS (MODULAR) ---

            const updateLocalSnapshotWidget = (data) => {
                document.getElementById('modal-projects-stat').textContent = data.projectsUnderway;
                document.getElementById('modal-funds-stat').textContent = data.fundsUtilized;
                document.getElementById('modal-grievances-stat').textContent = data.grievancesResolved;
            };

            const updateNationalStats = (data) => {
                document.getElementById('villages-covered-stat').textContent = data.villagesCovered.toLocaleString('en-IN');
                document.getElementById('beneficiaries-impacted-stat').textContent = data.beneficiariesImpacted.toLocaleString('en-IN');
                document.getElementById('funds-sanctioned-stat').textContent = `₹${data.fundsSanctioned.toLocaleString('en-IN')} Cr`;
                document.getElementById('works-completed-stat').textContent = data.worksCompleted.toLocaleString('en-IN');
            };

            const updateFunnelChart = (data) => {
                charts.funnelChart.data = { labels: ['Sanctioned', 'Released to State', 'Released to District', 'Utilized'], datasets: [{ data, backgroundColor: ['rgba(54, 162, 235, 0.6)','rgba(75, 192, 192, 0.6)','rgba(255, 206, 86, 0.6)','rgba(153, 102, 255, 0.6)'] }] };
                charts.funnelChart.update();
            };

            const updateDonutChart = (data) => {
                charts.donutChart.data = { labels: data.labels, datasets: [{ data: data.data, backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#9E9E9E'] }] };
                charts.donutChart.update();
            };

            const updateLineChart = (data) => {
                 charts.lineChart.data = { labels: ['Q3 2024', 'Q4 2024', 'Q1 2025', 'Q2 2025', 'Q3 2025'], datasets: [{ label: '% Projects Completed', data, fill: false, borderColor: 'rgb(75, 192, 192)', tension: 0.1 }] };
                 charts.lineChart.update();
            };
            
            const updateBarChart = (data) => {
                 charts.barChart.data = { labels: ['Rural Roads', 'Skill Training', 'Hostel Construction', 'Community Halls', 'Irrigation'], datasets: [{ label: 'Number of Projects', data, backgroundColor: '#FF6384' }] };
                 charts.barChart.update();
            };
            
            const updateLeaderboards = (data) => {
                const top5Body = document.getElementById('top-5-table-body');
                const bottom5Body = document.getElementById('bottom-5-table-body');
                top5Body.innerHTML = data.top5.map(row => `
                    <tr class="border-b"><td class="p-3">${row.state}</td><td class="p-3 text-center">${row.projects}% <i class="fas fa-arrow-up text-green-500"></i></td><td class="p-3 text-center">${row.funds}% <i class="fas fa-arrow-up text-green-500"></i></td></tr>`).join('');
                bottom5Body.innerHTML = data.bottom5.map(row => `
                    <tr class="border-b"><td class="p-3">${row.state}</td><td class="p-3 text-center">${row.projects}% <i class="fas fa-arrow-down text-red-500"></i></td><td class="p-3 text-center">${row.funds}% <i class="fas fa-arrow-down text-red-500"></i></td></tr>`).join('');
            };

            // --- INITIAL PAGE LOAD ---
            const loadDashboard = async () => {
                // Fetch all data concurrently
                const [
                    nationalStats,
                    funnelData,
                    donutData,
                    lineData,
                    barData,
                    leaderboardData
                ] = await Promise.all([
                    fetchNationalStats(),
                    fetchFunnelChartData(),
                    fetchDonutChartData(),
                    fetchLineChartData(),
                    fetchBarChartData(),
                    fetchLeaderboardData()
                ]);

                // Update all UI components with the fetched data
                updateNationalStats(nationalStats);
                updateFunnelChart(funnelData);
                updateDonutChart(donutData);
                updateLineChart(lineData);
                updateBarChart(barData);
                updateLeaderboards(leaderboardData);
            };

            loadDashboard();
        });
    </script>

</body>
</html>

